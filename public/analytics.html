<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOS ESPORTS — Performance Analytics</title>
<meta name="description" content="Track your neurocognitive training progress with detailed performance analytics.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
    :root {
        --gold: #FFD700;
        --gold-dim: rgba(255, 215, 0, 0.08);
        --gold-glow: rgba(255, 215, 0, 0.3);
        --orange: #FF6B35;
        --teal: #00D9A5;
        --cyan: #00CED1;
        --red: #FF1744;
        --dark: #0a0a0f;
        --darker: #050508;
        --card: #111118;
        --card-hover: #16161f;
        --text: #FFFFFF;
        --muted: #8892a0;
        --border: rgba(255,255,255,0.08);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: 'Outfit', sans-serif;
        background: var(--dark);
        color: var(--text);
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
    }

    /* ===== NAV ===== */
    .top-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: var(--darker);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .nav-logo {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.3rem;
        letter-spacing: 4px;
        color: var(--gold);
        text-decoration: none;
    }

    .nav-right { display: flex; align-items: center; gap: 8px; }

    .nav-btn {
        padding: 6px 14px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: transparent;
        color: var(--muted);
        font-family: 'Outfit', sans-serif;
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
    }

    .nav-btn:hover { color: var(--gold); border-color: var(--gold); }
    .nav-btn.active { color: var(--gold); border-color: var(--gold); background: var(--gold-dim); }

    /* ===== MAIN ===== */
    .main {
        flex: 1;
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px 15px 40px;
        width: 100%;
    }

    /* ===== PAGE HEADER ===== */
    .page-header {
        margin-bottom: 24px;
    }

    .page-header h1 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem;
        letter-spacing: 4px;
    }

    .page-header h1 .gold { color: var(--gold); }

    .page-header p {
        font-size: 0.78rem;
        color: var(--muted);
        margin-top: 2px;
    }

    /* ===== OVERVIEW STATS ===== */
    .overview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
    }

    .ov-card {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 16px;
        padding: 18px 14px;
        text-align: center;
        transition: all 0.3s;
    }

    .ov-card:hover { border-color: rgba(255,215,0,0.15); }

    .ov-val {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem;
        letter-spacing: 2px;
        line-height: 1;
        color: var(--gold);
    }

    .ov-val.teal { color: var(--teal); }
    .ov-val.orange { color: var(--orange); }
    .ov-val.cyan { color: var(--cyan); }

    .ov-lbl {
        font-size: 0.58rem;
        font-weight: 600;
        letter-spacing: 2px;
        text-transform: uppercase;
        color: var(--muted);
        margin-top: 6px;
    }

    /* ===== SECTION TITLE ===== */
    .sec-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.15rem;
        letter-spacing: 3px;
        color: var(--gold);
        margin-bottom: 12px;
        margin-top: 8px;
    }

    /* ===== PANELS ===== */
    .panel-grid {
        display: grid;
        gap: 12px;
        margin-bottom: 20px;
    }

    .grid-2 { grid-template-columns: 1fr 1fr; }
    .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
    .grid-2-1 { grid-template-columns: 2fr 1fr; }

    .panel {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 20px;
        padding: 22px 18px;
    }

    .panel-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 0.95rem;
        letter-spacing: 2px;
        color: var(--gold);
        margin-bottom: 14px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
    }

    /* ===== SCORE TREND CHART (Canvas) ===== */
    .chart-container {
        position: relative;
        width: 100%;
        height: 200px;
    }

    .chart-canvas {
        width: 100%;
        height: 100%;
    }

    .chart-empty {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 200px;
        font-size: 0.8rem;
        color: var(--muted);
    }

    /* ===== ACTIVITY HEATMAP ===== */
    .heatmap-row {
        display: flex;
        gap: 3px;
        flex-wrap: wrap;
    }

    .heat-cell {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        background: rgba(255,255,255,0.04);
        transition: all 0.2s;
        position: relative;
    }

    .heat-cell:hover { transform: scale(1.3); z-index: 2; }

    .heat-1 { background: rgba(255, 215, 0, 0.15); }
    .heat-2 { background: rgba(255, 215, 0, 0.3); }
    .heat-3 { background: rgba(255, 215, 0, 0.5); }
    .heat-4 { background: rgba(255, 215, 0, 0.75); }

    .heat-label-row {
        display: flex;
        gap: 6px;
        margin-top: 10px;
        align-items: center;
        font-size: 0.55rem;
        color: var(--muted);
    }

    .heat-sample {
        width: 12px;
        height: 12px;
        border-radius: 3px;
    }

    /* ===== GRADE DISTRIBUTION ===== */
    .grade-bars {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .grade-row {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .grade-letter {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.2rem;
        width: 24px;
        text-align: center;
        letter-spacing: 1px;
    }

    .grade-letter.s { color: var(--gold); }
    .grade-letter.a { color: var(--teal); }
    .grade-letter.b { color: var(--cyan); }
    .grade-letter.c { color: var(--muted); }

    .grade-bar-bg {
        flex: 1;
        height: 20px;
        background: rgba(255,255,255,0.04);
        border-radius: 10px;
        overflow: hidden;
    }

    .grade-bar-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.8s ease-out;
    }

    .grade-bar-fill.s { background: linear-gradient(90deg, var(--gold), var(--orange)); }
    .grade-bar-fill.a { background: linear-gradient(90deg, var(--teal), var(--cyan)); }
    .grade-bar-fill.b { background: var(--cyan); }
    .grade-bar-fill.c { background: rgba(136,146,160,0.4); }

    .grade-count {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--muted);
        width: 30px;
        text-align: right;
    }

    /* ===== PER GAME CARDS ===== */
    .game-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
    }

    .game-stat-card {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 20px;
        padding: 22px 18px;
        position: relative;
        overflow: hidden;
    }

    .game-stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
    }

    .game-stat-card.strobe::before { background: linear-gradient(90deg, var(--gold), var(--orange)); }
    .game-stat-card.flickshot::before { background: linear-gradient(90deg, var(--orange), #FF8F5E); }
    .game-stat-card.splitfocus::before { background: linear-gradient(90deg, var(--teal), var(--cyan)); }
    .game-stat-card.clutchtimer::before { background: linear-gradient(90deg, var(--cyan), #5BCCF6); }

    .gsc-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 14px;
    }

    .gsc-name {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.1rem;
        letter-spacing: 2px;
    }

    .game-stat-card.strobe .gsc-name { color: var(--gold); }
    .game-stat-card.flickshot .gsc-name { color: var(--orange); }
    .game-stat-card.splitfocus .gsc-name { color: var(--teal); }
    .game-stat-card.clutchtimer .gsc-name { color: var(--cyan); }

    .gsc-tier {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 0.85rem;
        letter-spacing: 1px;
        padding: 2px 8px;
        border-radius: 6px;
        background: rgba(255,255,255,0.06);
    }

    .gsc-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }

    .gsc-stat {
        text-align: center;
        padding: 8px 4px;
        background: rgba(255,255,255,0.02);
        border-radius: 10px;
    }

    .gsc-stat-val {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.3rem;
        letter-spacing: 1px;
        color: var(--text);
        line-height: 1;
    }

    .gsc-stat-lbl {
        font-size: 0.5rem;
        font-weight: 600;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: var(--muted);
        margin-top: 3px;
    }

    .gsc-sessions {
        font-size: 0.65rem;
        color: var(--muted);
        margin-top: 10px;
        text-align: center;
    }

    /* ===== INPUT SPLIT ===== */
    .input-split {
        display: flex;
        gap: 16px;
        align-items: center;
        justify-content: center;
        padding: 10px 0;
    }

    .input-item { text-align: center; }

    .input-icon {
        font-size: 2rem;
        display: block;
        margin-bottom: 6px;
    }

    .input-pct {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.6rem;
        letter-spacing: 1px;
    }

    .input-pct.mouse-c { color: var(--teal); }
    .input-pct.pad-c { color: var(--orange); }

    .input-label {
        font-size: 0.55rem;
        font-weight: 600;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: var(--muted);
    }

    .input-bar-track {
        width: 100%;
        height: 8px;
        background: rgba(255,255,255,0.06);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 12px;
    }

    .input-bar-fill {
        height: 100%;
        border-radius: 4px;
        background: linear-gradient(90deg, var(--teal), var(--orange));
        transition: width 0.8s ease-out;
    }

    /* ===== MILESTONES ===== */
    .milestone-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .milestone {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 10px;
        background: rgba(255,255,255,0.02);
        border: 1px solid var(--border);
    }

    .milestone-icon { font-size: 1.3rem; flex-shrink: 0; }

    .milestone-text {
        font-size: 0.75rem;
        font-weight: 500;
        color: var(--text);
    }

    .milestone-text span {
        color: var(--gold);
        font-weight: 700;
    }

    .milestone-date {
        font-size: 0.55rem;
        color: var(--muted);
        margin-left: auto;
        white-space: nowrap;
    }

    /* ===== LOADING / EMPTY ===== */
    .loading-state, .empty-state {
        text-align: center;
        padding: 60px 20px;
        font-size: 0.85rem;
        color: var(--muted);
    }

    .loading-state .icon, .empty-state .icon {
        font-size: 2.5rem;
        display: block;
        margin-bottom: 10px;
    }

    @keyframes pulse {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 1; }
    }

    .loading-state .dots { animation: pulse 1.2s ease-in-out infinite; }

    /* ===== FOOTER ===== */
    .footer {
        padding: 30px 20px;
        text-align: center;
        background: var(--darker);
        border-top: 1px solid var(--border);
    }

    .footer-logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 3px; margin-bottom: 8px; color: var(--gold); }
    .footer-links { margin: 10px 0; font-size: 0.65rem; }
    .footer-links a { color: var(--muted); text-decoration: none; margin: 0 8px; transition: color 0.3s; }
    .footer-links a:hover { color: var(--gold); }
    .footer-company { font-size: 0.65rem; color: var(--muted); }
    .footer-trademarks { font-size: 0.55rem; color: var(--muted); margin-top: 12px; line-height: 1.5; }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
        .grid-2, .grid-2-1, .grid-3 { grid-template-columns: 1fr; }
        .game-stats-grid { grid-template-columns: 1fr; }
        .overview-grid { grid-template-columns: repeat(3, 1fr); }
        .heat-cell { width: 14px; height: 14px; }
    }

    @media (max-width: 480px) {
        .overview-grid { grid-template-columns: repeat(2, 1fr); }
        .ov-val { font-size: 1.6rem; }
        .page-header h1 { font-size: 1.6rem; }
    }
</style>
</head>
<body>

<!-- ===== NAV ===== -->
<nav class="top-nav">
    <a href="/dashboard" class="nav-logo">BOS ESPORTS</a>
    <div class="nav-right">
        <a href="/dashboard" class="nav-btn">Dashboard</a>
        <a href="/leaderboard" class="nav-btn">Leaderboard</a>
        <a href="/analytics" class="nav-btn active">Analytics</a>
    </div>
</nav>

<!-- ===== MAIN ===== -->
<div class="main" id="mainContent">
    <div class="loading-state" id="loadingState">
        <span class="icon">&#128200;</span>
        <span class="dots">Loading your performance data...</span>
    </div>
</div>

<!-- ===== FOOTER ===== -->
<footer class="footer">
    <div class="footer-logo">BOS ESPORTS</div>
    <div class="footer-links">
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Use</a>
    </div>
    <div class="footer-company">&copy; 2026 GoStar Digital LLC. All Rights Reserved. &#127477;&#127479;</div>
    <div class="footer-trademarks">BOS Esports&trade; is a trademark of GoStar Digital LLC.</div>
</footer>

<script>
(function() {
    var mainContent = document.getElementById('mainContent');

    var gameLabels = {
        strobe: 'Strobe Drill', flickshot: 'FlickShot',
        splitfocus: 'Split Focus', clutchtimer: 'Clutch Timer'
    };

    var tierNames = ['', 'Bronze', 'Silver', 'Gold', 'Diamond', 'Radiant'];

    function formatDate(dateStr) {
        try {
            var d = new Date(dateStr);
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            return months[d.getMonth()] + ' ' + d.getDate();
        } catch (e) { return '--'; }
    }

    function formatFullDate(dateStr) {
        try {
            var d = new Date(dateStr);
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            return months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
        } catch (e) { return '--'; }
    }

    // ─── Draw trend chart on canvas ───
    function drawTrendChart(canvasId, trend) {
        var canvas = document.getElementById(canvasId);
        if (!canvas || trend.length < 2) return;

        var ctx = canvas.getContext('2d');
        var dpr = window.devicePixelRatio || 1;
        var rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);

        var w = rect.width;
        var h = rect.height;
        var padL = 40, padR = 15, padT = 15, padB = 30;
        var cw = w - padL - padR;
        var ch = h - padT - padB;

        var scores = trend.map(function(t) { return t.score; });
        var maxS = Math.max.apply(null, scores);
        var minS = Math.min.apply(null, scores);
        var range = maxS - minS || 1;

        // Grid lines
        ctx.strokeStyle = 'rgba(255,255,255,0.05)';
        ctx.lineWidth = 1;
        for (var i = 0; i <= 4; i++) {
            var gy = padT + (ch / 4) * i;
            ctx.beginPath();
            ctx.moveTo(padL, gy);
            ctx.lineTo(w - padR, gy);
            ctx.stroke();

            var val = Math.round(maxS - (range / 4) * i);
            ctx.fillStyle = 'rgba(136,146,160,0.5)';
            ctx.font = '10px Outfit';
            ctx.textAlign = 'right';
            ctx.fillText(val, padL - 6, gy + 3);
        }

        // Score line
        ctx.beginPath();
        ctx.strokeStyle = '#FFD700';
        ctx.lineWidth = 2.5;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';

        var points = [];
        for (var j = 0; j < trend.length; j++) {
            var x = padL + (cw / (trend.length - 1)) * j;
            var y = padT + ch - ((scores[j] - minS) / range) * ch;
            points.push({ x: x, y: y });
            if (j === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Gradient fill
        var gradient = ctx.createLinearGradient(0, padT, 0, h - padB);
        gradient.addColorStop(0, 'rgba(255, 215, 0, 0.15)');
        gradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
        ctx.lineTo(points[points.length - 1].x, h - padB);
        ctx.lineTo(points[0].x, h - padB);
        ctx.closePath();
        ctx.fillStyle = gradient;
        ctx.fill();

        // Accuracy line (dashed teal)
        var accs = trend.map(function(t) { return t.accuracy; });

        ctx.beginPath();
        ctx.strokeStyle = 'rgba(0, 217, 165, 0.6)';
        ctx.lineWidth = 1.5;
        ctx.setLineDash([4, 4]);

        for (var k = 0; k < trend.length; k++) {
            var ax = padL + (cw / (trend.length - 1)) * k;
            var ay = padT + ch - ((accs[k]) / 100) * ch;
            if (k === 0) ctx.moveTo(ax, ay);
            else ctx.lineTo(ax, ay);
        }
        ctx.stroke();
        ctx.setLineDash([]);

        // Score dots
        for (var d = 0; d < points.length; d++) {
            ctx.beginPath();
            ctx.arc(points[d].x, points[d].y, 3.5, 0, Math.PI * 2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
        }

        // X-axis labels
        ctx.fillStyle = 'rgba(136,146,160,0.5)';
        ctx.font = '9px Outfit';
        ctx.textAlign = 'center';
        var step = Math.max(1, Math.floor(trend.length / 6));
        for (var m = 0; m < trend.length; m += step) {
            var lx = padL + (cw / (trend.length - 1)) * m;
            ctx.fillText(formatDate(trend[m].date), lx, h - 6);
        }

        // Legend
        ctx.fillStyle = '#FFD700';
        ctx.fillRect(w - padR - 90, 6, 10, 3);
        ctx.fillStyle = 'rgba(136,146,160,0.7)';
        ctx.font = '9px Outfit';
        ctx.textAlign = 'left';
        ctx.fillText('Score', w - padR - 76, 10);

        ctx.strokeStyle = 'rgba(0, 217, 165, 0.6)';
        ctx.lineWidth = 1.5;
        ctx.setLineDash([3, 3]);
        ctx.beginPath();
        ctx.moveTo(w - padR - 90, 20);
        ctx.lineTo(w - padR - 80, 20);
        ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillText('Accuracy', w - padR - 76, 23);

        // Store trend for resize
        canvas._trend = trend;
    }

    // ─── Build heatmap ───
    function buildHeatmap(dailyActivity) {
        var html = '<div class="heatmap-row">';
        var now = new Date();

        for (var i = 29; i >= 0; i--) {
            var d = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
            var key = d.toISOString().split('T')[0];
            var count = dailyActivity[key] || 0;
            var cls = '';
            if (count >= 4) cls = 'heat-4';
            else if (count >= 3) cls = 'heat-3';
            else if (count >= 2) cls = 'heat-2';
            else if (count >= 1) cls = 'heat-1';

            var dayLabel = (d.getMonth() + 1) + '/' + d.getDate();
            html += '<div class="heat-cell ' + cls + '" title="' + dayLabel + ': ' + count + ' sessions"></div>';
        }

        html += '</div>';
        html += '<div class="heat-label-row">';
        html += '<span>Less</span>';
        html += '<div class="heat-sample" style="background:rgba(255,255,255,0.04)"></div>';
        html += '<div class="heat-sample heat-1"></div>';
        html += '<div class="heat-sample heat-2"></div>';
        html += '<div class="heat-sample heat-3"></div>';
        html += '<div class="heat-sample heat-4"></div>';
        html += '<span>More</span>';
        html += '</div>';

        return html;
    }

    // ─── Build milestones ───
    function buildMilestones(data) {
        var milestones = [];
        var o = data.overall;

        if (o.totalSessions >= 1) milestones.push({ icon: '&#127941;', text: 'First training session completed', date: data.firstSession });
        if (o.totalSessions >= 10) milestones.push({ icon: '&#128293;', text: '<span>10</span> sessions logged' });
        if (o.totalSessions >= 25) milestones.push({ icon: '&#9889;', text: '<span>25</span> sessions — dedicated grinder' });
        if (o.totalSessions >= 50) milestones.push({ icon: '&#128142;', text: '<span>50</span> sessions — diamond commitment' });
        if (o.totalSessions >= 100) milestones.push({ icon: '&#127942;', text: '<span>100</span> sessions — elite tier' });
        if (o.bestScore >= 1000) milestones.push({ icon: '&#128175;', text: 'Broke <span>1,000</span> points' });
        if (o.bestScore >= 3000) milestones.push({ icon: '&#128081;', text: 'Broke <span>3,000</span> — S-rank material' });
        if (o.bestStreak >= 10) milestones.push({ icon: '&#128165;', text: '<span>' + o.bestStreak + '</span> hit streak' });
        if (data.gradeCounts.S > 0) milestones.push({ icon: '&#11088;', text: 'First <span>S-rank</span> earned' });

        var gamesPlayed = Object.keys(data.perGame).length;
        if (gamesPlayed >= 2) milestones.push({ icon: '&#129504;', text: '<span>' + gamesPlayed + '</span> cognitive lanes trained' });
        if (gamesPlayed >= 4) milestones.push({ icon: '&#127775;', text: 'All <span>4 lanes</span> activated' });

        if (milestones.length === 0) {
            return '<div style="text-align:center;color:var(--muted);font-size:0.8rem;padding:20px;">Play sessions to unlock milestones!</div>';
        }

        var html = '<div class="milestone-list">';
        milestones.forEach(function(m) {
            html += '<div class="milestone">';
            html += '<span class="milestone-icon">' + m.icon + '</span>';
            html += '<span class="milestone-text">' + m.text + '</span>';
            if (m.date) html += '<span class="milestone-date">' + formatDate(m.date) + '</span>';
            html += '</div>';
        });
        html += '</div>';
        return html;
    }

    // ─── Render full analytics ───
    function renderAnalytics(data) {
        var a = data.analytics;
        var o = a.overall;
        var totalAcc = o.totalHits + o.totalMisses;
        var overallAcc = totalAcc > 0 ? Math.round((o.totalHits / totalAcc) * 100) : 0;

        var html = '';

        // Header
        html += '<div class="page-header">';
        html += '<h1>&#128200; <span class="gold">PERFORMANCE</span> ANALYTICS</h1>';
        html += '<p>Tracking ' + o.totalSessions + ' sessions since ' + formatFullDate(a.firstSession) + '</p>';
        html += '</div>';

        // Overview
        html += '<div class="overview-grid">';
        html += '<div class="ov-card"><div class="ov-val">' + o.totalSessions + '</div><div class="ov-lbl">Sessions</div></div>';
        html += '<div class="ov-card"><div class="ov-val orange">' + o.bestScore + '</div><div class="ov-lbl">Best Score</div></div>';
        html += '<div class="ov-card"><div class="ov-val">' + o.avgScore + '</div><div class="ov-lbl">Avg Score</div></div>';
        html += '<div class="ov-card"><div class="ov-val teal">' + o.avgAccuracy + '%</div><div class="ov-lbl">Avg Accuracy</div></div>';
        html += '<div class="ov-card"><div class="ov-val cyan">' + o.avgReaction + 'ms</div><div class="ov-lbl">Avg Reaction</div></div>';
        html += '<div class="ov-card"><div class="ov-val">' + o.bestStreak + '</div><div class="ov-lbl">Best Streak</div></div>';
        html += '<div class="ov-card"><div class="ov-val teal">' + o.totalHits + '</div><div class="ov-lbl">Total Hits</div></div>';
        html += '<div class="ov-card"><div class="ov-val orange">' + overallAcc + '%</div><div class="ov-lbl">Hit Rate</div></div>';
        html += '</div>';

        // Trend + Grades
        html += '<div class="panel-grid grid-2-1">';

        html += '<div class="panel">';
        html += '<div class="panel-title">&#128200; Score Trend (Last 20 Sessions)</div>';
        if (a.trend.length >= 2) {
            html += '<div class="chart-container"><canvas class="chart-canvas" id="trendCanvas"></canvas></div>';
        } else {
            html += '<div class="chart-empty">Need at least 2 sessions for trend data</div>';
        }
        html += '</div>';

        html += '<div class="panel">';
        html += '<div class="panel-title">&#127942; Grade Distribution</div>';
        var totalGrades = a.gradeCounts.S + a.gradeCounts.A + a.gradeCounts.B + a.gradeCounts.C;
        html += '<div class="grade-bars">';
        ['S', 'A', 'B', 'C'].forEach(function(g) {
            var count = a.gradeCounts[g];
            var pct = totalGrades > 0 ? Math.round((count / totalGrades) * 100) : 0;
            html += '<div class="grade-row">';
            html += '<span class="grade-letter ' + g.toLowerCase() + '">' + g + '</span>';
            html += '<div class="grade-bar-bg"><div class="grade-bar-fill ' + g.toLowerCase() + '" style="width:' + pct + '%"></div></div>';
            html += '<span class="grade-count">' + count + '</span>';
            html += '</div>';
        });
        html += '</div></div>';

        html += '</div>';

        // Per-Game
        html += '<div class="sec-title">&#127918; Per-Game Breakdown</div>';
        html += '<div class="game-stats-grid">';

        ['strobe', 'flickshot', 'splitfocus', 'clutchtimer'].forEach(function(g) {
            var gs = a.perGame[g];
            html += '<div class="game-stat-card ' + g + '">';
            html += '<div class="gsc-header">';
            html += '<div class="gsc-name">' + (gameLabels[g] || g) + '</div>';
            if (gs) {
                html += '<div class="gsc-tier">T' + gs.highestTier + ' ' + (tierNames[gs.highestTier] || '') + '</div>';
            } else {
                html += '<div class="gsc-tier" style="opacity:0.4;">Not Played</div>';
            }
            html += '</div>';

            if (gs) {
                html += '<div class="gsc-stats">';
                html += '<div class="gsc-stat"><div class="gsc-stat-val">' + gs.bestScore + '</div><div class="gsc-stat-lbl">Best Score</div></div>';
                html += '<div class="gsc-stat"><div class="gsc-stat-val">' + gs.avgScore + '</div><div class="gsc-stat-lbl">Avg Score</div></div>';
                html += '<div class="gsc-stat"><div class="gsc-stat-val">' + gs.avgAccuracy + '%</div><div class="gsc-stat-lbl">Accuracy</div></div>';
                html += '<div class="gsc-stat"><div class="gsc-stat-val">' + gs.avgReaction + 'ms</div><div class="gsc-stat-lbl">Reaction</div></div>';
                html += '</div>';
                html += '<div class="gsc-sessions">' + gs.sessions + ' sessions &bull; Last played ' + formatDate(gs.lastPlayed) + '</div>';
            } else {
                html += '<div style="text-align:center;color:var(--muted);font-size:0.75rem;padding:20px 0;">No sessions yet — start training!</div>';
            }
            html += '</div>';
        });

        html += '</div>';

        // Activity + Input + Milestones
        html += '<div class="panel-grid grid-3">';

        html += '<div class="panel">';
        html += '<div class="panel-title">&#128197; Activity (Last 30 Days)</div>';
        html += buildHeatmap(a.dailyActivity);
        html += '</div>';

        html += '<div class="panel">';
        html += '<div class="panel-title">&#127918; Input Device</div>';
        var totalInput = a.inputSplit.mouse + a.inputSplit.controller;
        var mousePct = totalInput > 0 ? Math.round((a.inputSplit.mouse / totalInput) * 100) : 0;
        var padPct = 100 - mousePct;
        html += '<div class="input-split">';
        html += '<div class="input-item"><span class="input-icon">&#128433;</span><div class="input-pct mouse-c">' + mousePct + '%</div><div class="input-label">Mouse/KB</div></div>';
        html += '<div class="input-item"><span class="input-icon">&#127918;</span><div class="input-pct pad-c">' + padPct + '%</div><div class="input-label">Controller</div></div>';
        html += '</div>';
        html += '<div class="input-bar-track"><div class="input-bar-fill" style="width:' + mousePct + '%"></div></div>';
        html += '</div>';

        html += '<div class="panel">';
        html += '<div class="panel-title">&#127941; Milestones</div>';
        html += buildMilestones(a);
        html += '</div>';

        html += '</div>';

        mainContent.innerHTML = html;

        // Draw chart after render
        if (a.trend.length >= 2) {
            setTimeout(function() { drawTrendChart('trendCanvas', a.trend); }, 50);
        }
    }

    function showEmpty() {
        mainContent.innerHTML = '<div class="page-header"><h1>&#128200; <span class="gold">PERFORMANCE</span> ANALYTICS</h1></div>' +
            '<div class="empty-state"><span class="icon">&#128170;</span>No training data yet. Complete some sessions to see your analytics!<br><br><a href="/dashboard" style="color:var(--gold);text-decoration:none;font-weight:600;">&#8592; Back to Dashboard</a></div>';
    }

    // Fetch
    fetch('/api/analytics')
        .then(function(res) {
            if (!res.ok) {
                if (res.status === 401) { window.location.href = '/'; return null; }
                throw new Error('Failed');
            }
            return res.json();
        })
        .then(function(data) {
            if (!data || !data.analytics) { showEmpty(); return; }
            renderAnalytics(data);
        })
        .catch(function() {
            mainContent.innerHTML = '<div class="empty-state"><span class="icon">&#9888;</span>Failed to load analytics. Try refreshing.</div>';
        });

    // Resize handler for chart
    var resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            var canvas = document.getElementById('trendCanvas');
            if (canvas && canvas._trend) drawTrendChart('trendCanvas', canvas._trend);
        }, 200);
    });
})();
</script>

</body>
</html>