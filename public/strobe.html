<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOS ESPORTS ‚Äî Strobe Drill</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #05060a;
    --bg-surface: #0a0c14;
    --bg-card: #0d1018;
    --neon: #00ff88;
    --neon-dim: rgba(0, 255, 136, 0.08);
    --neon-glow: rgba(0, 255, 136, 0.35);
    --electric: #00d4ff;
    --electric-dim: rgba(0, 212, 255, 0.08);
    --electric-glow: rgba(0, 212, 255, 0.3);
    --hot: #ff2d6b;
    --hot-dim: rgba(255, 45, 107, 0.08);
    --hot-glow: rgba(255, 45, 107, 0.3);
    --gold: #ffd54f;
    --gold-glow: rgba(255, 213, 79, 0.3);
    --text: #e8e6e1;
    --text-mid: #6b6e78;
    --text-dim: #2a2d36;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Exo 2', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    -webkit-font-smoothing: antialiased;
    user-select: none;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  .game-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }

  /* ‚îÄ‚îÄ‚îÄ HUD ‚îÄ‚îÄ‚îÄ */
  .hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid rgba(0,255,136,0.06);
    background: rgba(5,6,10,0.95);
    z-index: 10;
    flex-shrink: 0;
  }

  .hud-left { display: flex; align-items: center; gap: 1rem; }

  .back-btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-mid);
    background: transparent;
    border: 1px solid var(--text-dim);
    padding: 0.3rem 0.7rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .back-btn:hover { color: var(--neon); border-color: var(--neon); background: var(--neon-dim); }
  .back-btn svg { width: 10px; height: 10px; fill: currentColor; }

  .hud-logo {
    font-weight: 800;
    font-size: 0.9rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--neon);
    text-shadow: 0 0 15px var(--neon-glow);
  }

  .hud-logo span { color: var(--text-dim); font-weight: 400; font-size: 0.75rem; text-shadow: none; }

  .hud-rank {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--electric);
    background: var(--electric-dim);
    padding: 0.25rem 0.7rem;
  }

  .hud-center { display: flex; gap: 2.5rem; align-items: center; }
  .hud-stat { text-align: center; }

  .hud-stat-value { font-weight: 700; font-size: 1.3rem; line-height: 1; letter-spacing: 0.02em; }
  .hud-stat-value.score-val { color: var(--gold); text-shadow: 0 0 10px var(--gold-glow); }
  .hud-stat-value.streak-val { color: var(--neon); text-shadow: 0 0 8px var(--neon-glow); }
  .hud-stat-value.miss-val { color: var(--hot); }
  .hud-stat-value.time-val { color: var(--text); }

  .hud-stat-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.45rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 0.15rem;
  }

  .hud-right { display: flex; align-items: center; gap: 1rem; }

  .strobe-readout {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-mid);
    letter-spacing: 0.1em;
  }

  .strobe-readout strong { color: var(--neon); font-size: 0.75rem; }

  /* Input mode indicator */
  .input-indicator {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.2rem 0.6rem;
    border: 1px solid var(--text-dim);
    transition: all 0.3s ease;
  }

  .input-indicator.controller-active {
    color: var(--neon);
    border-color: rgba(0,255,136,0.2);
    background: var(--neon-dim);
  }

  .input-indicator.mouse-active {
    color: var(--text-mid);
    border-color: var(--text-dim);
  }

  .input-icon { font-size: 0.75rem; }

  /* ‚îÄ‚îÄ‚îÄ PLAY AREA ‚îÄ‚îÄ‚îÄ */
  .play-area {
    flex: 1;
    position: relative;
    overflow: hidden;
    cursor: crosshair;
  }

  .play-area.controller-mode { cursor: none; }

  .grid-overlay {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,136,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,136,0.02) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  .center-mark {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    opacity: 0.06;
  }

  .center-mark::before, .center-mark::after {
    content: '';
    position: absolute;
    background: var(--neon);
  }

  .center-mark::before { width: 40px; height: 1px; top: 0; left: -20px; }
  .center-mark::after { width: 1px; height: 40px; top: -20px; left: 0; }

  .strobe-overlay {
    position: absolute;
    inset: 0;
    background: var(--bg);
    z-index: 5;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.04s linear;
  }

  .strobe-overlay.active { opacity: 1; }

  /* ‚îÄ‚îÄ‚îÄ GAMEPAD CROSSHAIR ‚îÄ‚îÄ‚îÄ */
  .gamepad-crosshair {
    position: absolute;
    z-index: 8;
    pointer-events: none;
    display: none;
    transform: translate(-50%, -50%);
  }

  .gamepad-crosshair.visible { display: block; }

  .crosshair-outer {
    width: 40px; height: 40px;
    position: relative;
  }

  /* 4 lines forming crosshair with center gap */
  .crosshair-outer::before {
    content: '';
    position: absolute;
    top: 19px; left: 0;
    width: 14px; height: 2px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow), 0 0 20px rgba(0,255,136,0.15);
  }

  .crosshair-outer::after {
    content: '';
    position: absolute;
    top: 19px; right: 0;
    width: 14px; height: 2px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow), 0 0 20px rgba(0,255,136,0.15);
  }

  .crosshair-v-top, .crosshair-v-bottom {
    position: absolute;
    left: 19px;
    width: 2px;
    height: 14px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow), 0 0 20px rgba(0,255,136,0.15);
  }

  .crosshair-v-top { top: 0; }
  .crosshair-v-bottom { bottom: 0; }

  .crosshair-dot {
    position: absolute;
    top: 18px; left: 18px;
    width: 4px; height: 4px;
    border-radius: 50%;
    background: var(--neon);
    box-shadow: 0 0 10px var(--neon-glow);
  }

  /* Fire flash effect */
  .crosshair-flash {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    border: 1px solid var(--neon);
    border-radius: 50%;
    opacity: 0;
    box-shadow: 0 0 20px var(--neon-glow);
    transition: none;
  }

  .crosshair-flash.firing {
    animation: crosshairFire 0.2s ease-out forwards;
  }

  @keyframes crosshairFire {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
  }

  /* On-target glow */
  .gamepad-crosshair.on-target .crosshair-outer::before,
  .gamepad-crosshair.on-target .crosshair-outer::after,
  .gamepad-crosshair.on-target .crosshair-v-top,
  .gamepad-crosshair.on-target .crosshair-v-bottom {
    background: var(--hot);
    box-shadow: 0 0 8px var(--hot-glow), 0 0 20px rgba(255,45,107,0.15);
  }

  .gamepad-crosshair.on-target .crosshair-dot {
    background: var(--hot);
    box-shadow: 0 0 10px var(--hot-glow);
  }

  /* ‚îÄ‚îÄ‚îÄ TARGETS ‚îÄ‚îÄ‚îÄ */
  .target { position: absolute; z-index: 3; cursor: crosshair; }

  .target-ring {
    width: 56px; height: 56px;
    border-radius: 50%;
    border: 2px solid var(--neon);
    background: var(--neon-dim);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    animation: targetPulse 0.8s ease-in-out infinite;
    box-shadow: 0 0 15px var(--neon-glow), inset 0 0 15px rgba(0,255,136,0.05);
  }

  .target-ring::before {
    content: '';
    position: absolute;
    inset: -8px;
    border-radius: 50%;
    border: 1px solid rgba(0,255,136,0.1);
    animation: targetExpand 1s ease-out infinite;
  }

  .target-core { width: 16px; height: 16px; position: relative; }

  .target-core::before, .target-core::after {
    content: '';
    position: absolute;
    background: var(--neon);
    box-shadow: 0 0 6px var(--neon-glow);
  }

  .target-core::before { width: 16px; height: 2px; top: 7px; left: 0; }
  .target-core::after { width: 2px; height: 16px; top: 0; left: 7px; }

  .target.bonus .target-ring { border-color: var(--electric); background: var(--electric-dim); box-shadow: 0 0 15px var(--electric-glow), inset 0 0 15px rgba(0,212,255,0.05); }
  .target.bonus .target-ring::before { border-color: rgba(0,212,255,0.1); }
  .target.bonus .target-core::before, .target.bonus .target-core::after { background: var(--electric); box-shadow: 0 0 6px var(--electric-glow); }

  .target.decoy .target-ring { border-color: var(--hot); background: var(--hot-dim); border-style: dashed; box-shadow: 0 0 10px var(--hot-glow); }
  .target.decoy .target-ring::before { border-color: rgba(255,45,107,0.1); }
  .target.decoy .target-core::before { background: var(--hot); box-shadow: 0 0 4px var(--hot-glow); width: 10px; left: 3px; }
  .target.decoy .target-core::after { background: var(--hot); box-shadow: 0 0 4px var(--hot-glow); height: 10px; top: 3px; }

  .hit-effect {
    position: absolute;
    width: 56px; height: 56px;
    border-radius: 50%;
    border: 2px solid var(--neon);
    box-shadow: 0 0 20px var(--neon-glow);
    transform: translate(-50%, -50%);
    animation: hitBurst 0.5s ease-out forwards;
    pointer-events: none;
    z-index: 4;
  }

  .hit-effect.bonus { border-color: var(--electric); box-shadow: 0 0 20px var(--electric-glow); }

  .hit-score {
    position: absolute;
    transform: translate(-50%, -50%);
    font-family: 'Exo 2', sans-serif;
    font-weight: 800;
    font-size: 1.2rem;
    color: var(--gold);
    text-shadow: 0 0 15px var(--gold-glow);
    animation: scoreFloat 0.8s ease-out forwards;
    pointer-events: none;
    z-index: 6;
  }

  .hit-score.bonus { color: var(--electric); text-shadow: 0 0 15px var(--electric-glow); font-size: 1.5rem; }
  .hit-score.penalty { color: var(--hot); text-shadow: 0 0 10px var(--hot-glow); }

  /* ‚îÄ‚îÄ‚îÄ BOTTOM BAR ‚îÄ‚îÄ‚îÄ */
  .bottom-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.7rem 1.5rem;
    border-top: 1px solid rgba(0,255,136,0.06);
    background: rgba(5,6,10,0.95);
    z-index: 10;
    flex-shrink: 0;
  }

  .strobe-indicator { display: flex; align-items: center; gap: 0.5rem; }

  .strobe-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow);
    animation: strobeBlink 1s ease-in-out infinite;
  }

  .strobe-text {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-mid);
  }

  .progress-section { display: flex; align-items: center; gap: 1rem; }

  .progress-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
  }

  .progress-track { width: 120px; height: 3px; background: rgba(255,255,255,0.04); overflow: hidden; }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--neon), var(--electric));
    box-shadow: 0 0 6px var(--neon-glow);
    transition: width 0.3s ease;
  }

  .accuracy-display {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--neon);
    letter-spacing: 0.08em;
    text-shadow: 0 0 8px var(--neon-glow);
  }

  /* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
  .screen-overlay {
    position: absolute;
    inset: 0;
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(5, 6, 10, 0.97);
    backdrop-filter: blur(20px);
    text-align: center;
    padding: 2rem;
  }

  .screen-overlay.hidden { display: none; }

  .start-icon { font-size: 3.5rem; margin-bottom: 1.5rem; animation: float 3s ease-in-out infinite; }

  .start-title {
    font-weight: 900;
    font-size: clamp(2.5rem, 6vw, 4rem);
    text-transform: uppercase;
    line-height: 0.95;
    letter-spacing: 0.02em;
  }

  .start-title .glow {
    display: block;
    color: var(--neon);
    text-shadow: 0 0 30px var(--neon-glow), 0 0 60px rgba(0,255,136,0.1);
  }

  .start-desc {
    color: var(--text-mid);
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.72rem;
    line-height: 1.8;
    max-width: 440px;
    margin: 1.5rem 0 1.5rem;
    letter-spacing: 0.02em;
  }

  .input-hint {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .input-hint-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .input-hint-item .icon { font-size: 0.85rem; }

  .input-hint-item.active { color: var(--neon); }

  .tier-select { display: flex; gap: 0.4rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center; }

  .tier-btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    background: transparent;
    color: var(--text-dim);
    border: 1px solid rgba(255,255,255,0.06);
    padding: 0.45rem 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tier-btn.active { color: var(--neon); border-color: var(--neon); background: var(--neon-dim); box-shadow: 0 0 10px rgba(0,255,136,0.1); }
  .tier-btn:hover:not(.active) { border-color: rgba(255,255,255,0.12); color: var(--text-mid); }

  /* Focused tier btn (gamepad navigation) */
  .tier-btn.gp-focus {
    outline: 2px solid var(--electric);
    outline-offset: 2px;
    box-shadow: 0 0 15px var(--electric-glow);
  }

  .start-btn {
    font-family: 'Exo 2', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    background: var(--neon);
    color: var(--bg);
    border: none;
    padding: 1rem 3rem;
    cursor: pointer;
    transition: all 0.3s ease;
    clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
  }

  .start-btn:hover { box-shadow: 0 0 40px var(--neon-glow); transform: translateY(-2px); }

  .btn-back-home {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-dim);
    text-decoration: none;
    transition: color 0.2s;
    margin-top: 1.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .btn-back-home:hover { color: var(--neon); }
  .btn-back-home svg { width: 10px; height: 10px; fill: currentColor; }

  .countdown-num {
    font-weight: 900;
    font-size: 8rem;
    color: var(--neon);
    text-shadow: 0 0 60px var(--neon-glow), 0 0 120px rgba(0,255,136,0.15);
    line-height: 1;
    animation: countPop 0.5s ease-out;
  }

  .countdown-sub {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 1rem;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    background: rgba(0,255,136,0.04);
    border: 1px solid rgba(0,255,136,0.06);
    max-width: 480px;
    width: 100%;
    margin: 2rem 0;
  }

  .result-cell { background: var(--bg-card); padding: 1.5rem 1rem; text-align: center; }

  .result-value { font-weight: 800; font-size: 1.8rem; line-height: 1; }
  .result-value.gold { color: var(--gold); text-shadow: 0 0 10px var(--gold-glow); }
  .result-value.neon { color: var(--neon); text-shadow: 0 0 10px var(--neon-glow); }
  .result-value.electric { color: var(--electric); text-shadow: 0 0 10px var(--electric-glow); }

  .result-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.45rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 0.3rem;
  }

  .result-grade { font-size: 4.5rem; font-weight: 900; line-height: 1; margin-bottom: 0.3rem; }
  .result-grade.s-rank { color: var(--gold); text-shadow: 0 0 40px var(--gold-glow); }
  .result-grade.a-rank { color: var(--neon); text-shadow: 0 0 30px var(--neon-glow); }
  .result-grade.b-rank { color: var(--electric); text-shadow: 0 0 20px var(--electric-glow); }
  .result-grade.c-rank { color: var(--text-mid); }

  .result-rank {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .result-msg {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-mid);
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
  }

  .result-input-tag {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 1rem;
  }

  .btn-group { display: flex; gap: 0.8rem; flex-wrap: wrap; justify-content: center; }

  .btn-secondary {
    font-family: 'Exo 2', sans-serif;
    font-weight: 600;
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    background: transparent;
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.08);
    padding: 0.7rem 1.8rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    display: inline-block;
    text-align: center;
  }

  .btn-secondary:hover { border-color: var(--neon); color: var(--neon); background: var(--neon-dim); }

  /* Gamepad button hints on screens */
  .gp-hints {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-top: 1rem;
    display: none;
  }

  .gp-hints.visible { display: block; }

  .gp-hint-key {
    display: inline-block;
    border: 1px solid var(--text-dim);
    padding: 0.15rem 0.4rem;
    margin: 0 0.2rem;
    font-size: 0.5rem;
    border-radius: 2px;
  }

  @keyframes targetPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.06); } }
  @keyframes targetExpand { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.8); opacity: 0; } }
  @keyframes hitBurst { 0% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(3); opacity: 0; } }
  @keyframes scoreFloat { 0% { transform: translate(-50%, -50%) translateY(0); opacity: 1; } 100% { transform: translate(-50%, -50%) translateY(-60px); opacity: 0; } }
  @keyframes strobeBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  @keyframes countPop { 0% { transform: scale(0.5); opacity: 0; } 60% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

  @media (max-width: 600px) {
    .hud-center { gap: 1rem; }
    .hud-stat-value { font-size: 1rem; }
    .bottom-bar { flex-wrap: wrap; gap: 0.5rem; }
    .progress-section { display: none; }
    .target-ring { width: 48px; height: 48px; }
    .hud-logo { display: none; }
    .input-indicator { display: none; }
  }
</style>
</head>
<body>

<div class="game-wrapper">
  <div class="hud">
    <div class="hud-left">
      <a href="/dashboard" class="back-btn">
        <svg viewBox="0 0 12 12"><path d="M8 1L3 6l5 5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        HUB
      </a>
      <div class="hud-logo">BOS<span> ESPORTS</span></div>
      <div class="hud-rank" id="tierDisplay">BRONZE</div>
    </div>
    <div class="hud-center">
      <div class="hud-stat"><div class="hud-stat-value score-val" id="scoreDisplay">0</div><div class="hud-stat-label">Score</div></div>
      <div class="hud-stat"><div class="hud-stat-value streak-val" id="streakDisplay">0</div><div class="hud-stat-label">Streak</div></div>
      <div class="hud-stat"><div class="hud-stat-value miss-val" id="missDisplay">0</div><div class="hud-stat-label">Missed</div></div>
      <div class="hud-stat"><div class="hud-stat-value time-val" id="timeDisplay">60</div><div class="hud-stat-label">Time</div></div>
    </div>
    <div class="hud-right">
      <div class="input-indicator mouse-active" id="inputIndicator">
        <span class="input-icon" id="inputIcon">üñ±Ô∏è</span>
        <span id="inputLabel">MOUSE</span>
      </div>
      <div class="strobe-readout">STROBE <strong id="strobeRate">OFF</strong> Hz</div>
    </div>
  </div>

  <div class="play-area" id="playArea">
    <div class="grid-overlay"></div>
    <div class="center-mark"></div>
    <div class="strobe-overlay" id="strobeOverlay"></div>

    <!-- Gamepad crosshair -->
    <div class="gamepad-crosshair" id="gpCrosshair">
      <div class="crosshair-outer">
        <div class="crosshair-v-top"></div>
        <div class="crosshair-v-bottom"></div>
        <div class="crosshair-dot"></div>
      </div>
      <div class="crosshair-flash" id="crosshairFlash"></div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="strobe-indicator">
      <div class="strobe-dot" id="strobeDot"></div>
      <span class="strobe-text" id="strobeLabel">Strobe Off</span>
    </div>
    <div class="progress-section">
      <span class="progress-label">Round</span>
      <div class="progress-track"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
    </div>
    <div class="accuracy-display" id="accuracyDisplay">ACC 100%</div>
  </div>

  <!-- START SCREEN -->
  <div class="screen-overlay" id="startScreen">
    <div class="start-icon">üéØ</div>
    <h1 class="start-title">Strobe<span class="glow">Drill</span></h1>
    <p class="start-desc">
      Acquire and eliminate targets while strobe disruptions black out your vision.
      Trains reaction speed, visual tracking, and target acquisition under cognitive pressure.
    </p>
    <div class="input-hint" id="inputHints">
      <div class="input-hint-item active"><span class="icon">üñ±Ô∏è</span> Mouse + Click</div>
      <div class="input-hint-item" id="gpHint"><span class="icon">üéÆ</span> Controller ‚Äî Connect to activate</div>
    </div>
    <div class="tier-select" id="tierSelect">
      <button class="tier-btn active" data-tier="1">Bronze</button>
      <button class="tier-btn" data-tier="2">Silver</button>
      <button class="tier-btn" data-tier="3">Gold</button>
      <button class="tier-btn" data-tier="4">Diamond</button>
      <button class="tier-btn" data-tier="5">Radiant</button>
    </div>
    <button class="start-btn" id="startBtn">Start Match</button>
    <div class="gp-hints" id="gpStartHints">
      <span class="gp-hint-key">A</span> Start &nbsp; <span class="gp-hint-key">D-Pad</span> Select Rank
    </div>
    <a href="/dashboard" class="btn-back-home">
      <svg viewBox="0 0 12 12"><path d="M8 1L3 6l5 5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Back to BOS Esports
    </a>
  </div>

  <!-- COUNTDOWN -->
  <div class="screen-overlay hidden" id="countdownScreen">
    <div class="countdown-num" id="countdownNumber">3</div>
    <div class="countdown-sub">Match Starting ‚Äî Lock In</div>
  </div>

  <!-- RESULTS -->
  <div class="screen-overlay hidden" id="resultsScreen">
    <div class="result-rank" id="resultRankLabel" style="color: var(--gold)">RADIANT</div>
    <div class="result-grade" id="resultGrade">S</div>
    <div class="result-msg" id="resultMsg">Elite cognitive performance</div>
    <div class="result-input-tag" id="resultInputTag">Played with: Mouse</div>
    <div class="results-grid">
      <div class="result-cell"><div class="result-value gold" id="resultScore">0</div><div class="result-label">Final Score</div></div>
      <div class="result-cell"><div class="result-value neon" id="resultAccuracy">0%</div><div class="result-label">Accuracy</div></div>
      <div class="result-cell"><div class="result-value electric" id="resultStreak">0</div><div class="result-label">Best Streak</div></div>
      <div class="result-cell"><div class="result-value gold" id="resultHits">0</div><div class="result-label">Eliminations</div></div>
      <div class="result-cell"><div class="result-value neon" id="resultReaction">0ms</div><div class="result-label">Avg Reaction</div></div>
      <div class="result-cell"><div class="result-value electric" id="resultTier">BRZ</div><div class="result-label">Rank</div></div>
    </div>
    <div class="btn-group">
      <button class="start-btn" id="rematchBtn">Rematch</button>
      <button class="btn-secondary" id="menuBtn">Menu</button>
      <a href="/dashboard" class="btn-secondary">‚Üê Hub</a>
    </div>
    <div class="gp-hints" id="gpResultHints">
      <span class="gp-hint-key">A</span> Rematch &nbsp; <span class="gp-hint-key">B</span> Menu
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const state = {
  tier: 1, score: 0, streak: 0, bestStreak: 0,
  hits: 0, misses: 0, totalTargets: 0,
  timeLeft: 60, running: false, reactionTimes: [],
  screen: 'start', // start | countdown | playing | results
  inputMode: 'mouse', // mouse | controller
};

const TIERS = {
  1: { strobeRate: 0,   strobeDark: 0,   targetLife: 2200, spawnRate: 1800, maxTargets: 1, decoys: false, name: 'BRONZE',  short: 'BRZ' },
  2: { strobeRate: 60,  strobeDark: 200, targetLife: 2000, spawnRate: 1600, maxTargets: 2, decoys: false, name: 'SILVER',  short: 'SLV' },
  3: { strobeRate: 90,  strobeDark: 350, targetLife: 1700, spawnRate: 1400, maxTargets: 2, decoys: true,  name: 'GOLD',    short: 'GLD' },
  4: { strobeRate: 120, strobeDark: 450, targetLife: 1400, spawnRate: 1200, maxTargets: 3, decoys: true,  name: 'DIAMOND', short: 'DIA' },
  5: { strobeRate: 150, strobeDark: 550, targetLife: 1100, spawnRate: 1000, maxTargets: 3, decoys: true,  name: 'RADIANT', short: 'RAD' },
};

let config, gameTimer, strobeTimer, spawnTimer, targetIdCounter = 0;
const $ = id => document.getElementById(id);
const playArea = $('playArea');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAMEPAD SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const gp = {
  connected: false,
  index: null,
  crossX: 0,
  crossY: 0,
  sensitivity: 8,
  deadzone: 0.15,
  prevButtons: {},
  fireHeld: false,
};

// Gamepad connect/disconnect
window.addEventListener('gamepadconnected', (e) => {
  gp.connected = true;
  gp.index = e.gamepad.index;
  setInputMode('controller');

  // Center crosshair
  const area = playArea.getBoundingClientRect();
  gp.crossX = area.width / 2;
  gp.crossY = area.height / 2;
  updateCrosshairPosition();


});

window.addEventListener('gamepaddisconnected', () => {
  gp.connected = false;
  gp.index = null;
  setInputMode('mouse');

});

// Switch input mode
function setInputMode(mode) {
  state.inputMode = mode;
  const ind = $('inputIndicator');
  const crosshair = $('gpCrosshair');

  if (mode === 'controller') {
    ind.className = 'input-indicator controller-active';
    $('inputIcon').textContent = 'üéÆ';
    $('inputLabel').textContent = 'CONTROLLER';
    crosshair.classList.add('visible');
    playArea.classList.add('controller-mode');
    $('gpHint').innerHTML = '<span class="icon">üéÆ</span> Controller Connected ‚úì';
    $('gpHint').classList.add('active');
    document.querySelectorAll('.gp-hints').forEach(h => h.classList.add('visible'));
  } else {
    ind.className = 'input-indicator mouse-active';
    $('inputIcon').textContent = 'üñ±Ô∏è';
    $('inputLabel').textContent = 'MOUSE';
    crosshair.classList.remove('visible');
    playArea.classList.remove('controller-mode');
    document.querySelectorAll('.gp-hints').forEach(h => h.classList.remove('visible'));
  }
}

// Switch to mouse on mouse movement
document.addEventListener('mousemove', () => {
  if (state.inputMode === 'controller' && !gp.connected) {
    setInputMode('mouse');
  } else if (state.inputMode === 'controller') {
    // Keep controller mode if connected, but allow mouse too
  }
});

// Update crosshair element position
function updateCrosshairPosition() {
  const ch = $('gpCrosshair');
  ch.style.left = gp.crossX + 'px';
  ch.style.top = gp.crossY + 'px';
}

// Check if crosshair is over a target
function getCrosshairTarget() {
  const targets = playArea.querySelectorAll('.target');
  for (const t of targets) {
    const r = t.getBoundingClientRect();
    const pr = playArea.getBoundingClientRect();
    const tx = r.left - pr.left;
    const ty = r.top - pr.top;
    const cx = gp.crossX;
    const cy = gp.crossY;
    // Check if crosshair center is within target bounds (generous hitbox)
    const hitPad = 10;
    if (cx >= tx - hitPad && cx <= tx + r.width + hitPad && cy >= ty - hitPad && cy <= ty + r.height + hitPad) {
      return t;
    }
  }
  return null;
}

// Fire crosshair flash
function fireCrosshair() {
  const flash = $('crosshairFlash');
  flash.classList.remove('firing');
  void flash.offsetWidth;
  flash.classList.add('firing');
}

// Button press detection (rising edge)
function buttonPressed(gpad, index) {
  const pressed = gpad.buttons[index] && gpad.buttons[index].pressed;
  const wasPressed = gp.prevButtons[index] || false;
  gp.prevButtons[index] = pressed;
  return pressed && !wasPressed;
}

// Trigger value (analog)
function triggerValue(gpad, index) {
  return gpad.buttons[index] ? gpad.buttons[index].value : 0;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAMEPAD POLL LOOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gamepadLoop() {
  if (!gp.connected) {
    requestAnimationFrame(gamepadLoop);
    return;
  }

  const gpads = navigator.getGamepads();
  const gpad = gpads[gp.index];
  if (!gpad) {
    requestAnimationFrame(gamepadLoop);
    return;
  }

  // Auto-switch to controller on any input
  const hasInput = gpad.axes.some(a => Math.abs(a) > gp.deadzone) || gpad.buttons.some(b => b.pressed);
  if (hasInput && state.inputMode !== 'controller') {
    setInputMode('controller');
    const area = playArea.getBoundingClientRect();
    gp.crossX = area.width / 2;
    gp.crossY = area.height / 2;
  }

  // ‚îÄ‚îÄ‚îÄ SCREEN: START ‚îÄ‚îÄ‚îÄ
  if (state.screen === 'start') {
    // D-pad left/right to change tier
    if (buttonPressed(gpad, 14)) { // D-pad left
      state.tier = Math.max(1, state.tier - 1);
      selectTierUI(state.tier);
    }
    if (buttonPressed(gpad, 15)) { // D-pad right
      state.tier = Math.min(5, state.tier + 1);
      selectTierUI(state.tier);
    }
    // A button to start
    if (buttonPressed(gpad, 0)) {
      startCountdown();
    }
  }

  // ‚îÄ‚îÄ‚îÄ SCREEN: PLAYING ‚îÄ‚îÄ‚îÄ
  if (state.screen === 'playing') {
    // Left stick ‚Üí move crosshair
    const lx = gpad.axes[0];
    const ly = gpad.axes[1];
    const area = playArea.getBoundingClientRect();

    if (Math.abs(lx) > gp.deadzone) {
      gp.crossX += lx * gp.sensitivity;
    }
    if (Math.abs(ly) > gp.deadzone) {
      gp.crossY += ly * gp.sensitivity;
    }

    // Clamp to play area
    gp.crossX = Math.max(0, Math.min(area.width, gp.crossX));
    gp.crossY = Math.max(0, Math.min(area.height, gp.crossY));
    updateCrosshairPosition();

    // Check if over target for visual feedback
    const overTarget = getCrosshairTarget();
    $('gpCrosshair').classList.toggle('on-target', !!overTarget);

    // R2/RT (index 7) or A button (index 0) to fire
    const r2 = triggerValue(gpad, 7);
    const fireTriggered = buttonPressed(gpad, 7) || buttonPressed(gpad, 0) || (r2 > 0.5 && !gp.fireHeld);
    gp.fireHeld = r2 > 0.5;

    if (fireTriggered && state.running) {
      fireCrosshair();
      if (overTarget) {
        hitTarget(overTarget);
      } else {
        // Miss
        state.misses++;
        state.streak = 0;
        updateHUD();
      }
    }
  }

  // ‚îÄ‚îÄ‚îÄ SCREEN: RESULTS ‚îÄ‚îÄ‚îÄ
  if (state.screen === 'results') {
    if (buttonPressed(gpad, 0)) { // A = rematch
      restartGame();
    }
    if (buttonPressed(gpad, 1)) { // B = menu
      backToMenu();
    }
  }

  requestAnimationFrame(gamepadLoop);
}

// Start the gamepad loop
requestAnimationFrame(gamepadLoop);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TIER SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectTierUI(t) {
  state.tier = t;
  document.querySelectorAll('.tier-btn').forEach(b => {
    b.classList.toggle('active', parseInt(b.dataset.tier) === t);
  });
}

// Mouse tier clicks
$('tierSelect').addEventListener('click', (e) => {
  const btn = e.target.closest('.tier-btn');
  if (!btn) return;
  selectTierUI(parseInt(btn.dataset.tier));
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME FLOW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
$('startBtn').addEventListener('click', startCountdown);
$('rematchBtn').addEventListener('click', restartGame);
$('menuBtn').addEventListener('click', backToMenu);

function startCountdown() {
  state.screen = 'countdown';
  $('startScreen').classList.add('hidden');
  $('countdownScreen').classList.remove('hidden');
  let count = 3;
  $('countdownNumber').textContent = count;
  const iv = setInterval(() => {
    count--;
    if (count > 0) {
      $('countdownNumber').textContent = count;
      $('countdownNumber').style.animation = 'none';
      void $('countdownNumber').offsetWidth;
      $('countdownNumber').style.animation = 'countPop 0.5s ease-out';
    } else {
      clearInterval(iv);
      $('countdownScreen').classList.add('hidden');
      startGame();
    }
  }, 800);
}

function startGame() {
  state.screen = 'playing';
  config = TIERS[state.tier];
  Object.assign(state, { score: 0, streak: 0, bestStreak: 0, hits: 0, misses: 0, totalTargets: 0, timeLeft: 60, running: true, reactionTimes: [] });
  $('tierDisplay').textContent = config.name;
  $('strobeRate').textContent = config.strobeRate || 'OFF';
  updateHUD();

  // Reset crosshair to center
  if (gp.connected) {
    const area = playArea.getBoundingClientRect();
    gp.crossX = area.width / 2;
    gp.crossY = area.height / 2;
    updateCrosshairPosition();
  }

  gameTimer = setInterval(() => {
    state.timeLeft--;
    $('timeDisplay').textContent = state.timeLeft;
    $('progressFill').style.width = ((60 - state.timeLeft) / 60 * 100) + '%';
    if (state.timeLeft <= 0) endGame();
  }, 1000);

  if (config.strobeRate > 0) {
    const ms = 60000 / config.strobeRate;
    strobeTimer = setInterval(() => {
      if (!state.running) return;
      $('strobeOverlay').classList.add('active');
      setTimeout(() => $('strobeOverlay').classList.remove('active'), config.strobeDark);
    }, ms);
    $('strobeLabel').textContent = 'Strobe Active';
    $('strobeDot').style.background = 'var(--neon)';
    $('strobeDot').style.animation = 'strobeBlink 1s ease-in-out infinite';
  } else {
    $('strobeLabel').textContent = 'Strobe Off';
    $('strobeDot').style.background = 'var(--text-dim)';
    $('strobeDot').style.animation = 'none';
  }

  spawnTarget();
  spawnTimer = setInterval(() => {
    if (!state.running) return;
    if (document.querySelectorAll('.target').length < config.maxTargets) spawnTarget();
  }, config.spawnRate);

  playArea.addEventListener('click', onMouseClick);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TARGETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnTarget() {
  if (!state.running) return;
  const isDecoy = config.decoys && Math.random() < 0.25;
  const isBonus = !isDecoy && Math.random() < 0.12;
  const area = playArea.getBoundingClientRect();
  const m = 40;
  const x = m + Math.random() * (area.width - 56 - m * 2);
  const y = m + Math.random() * (area.height - 56 - m * 2);

  const el = document.createElement('div');
  el.className = `target ${isDecoy ? 'decoy' : ''} ${isBonus ? 'bonus' : ''}`;
  el.dataset.type = isDecoy ? 'decoy' : (isBonus ? 'bonus' : 'normal');
  el.dataset.spawn = Date.now();
  el.style.left = x + 'px'; el.style.top = y + 'px';
  el.innerHTML = '<div class="target-ring"><div class="target-core"></div></div>';

  // Mouse click on target
  el.addEventListener('click', (e) => { e.stopPropagation(); hitTarget(el); });

  playArea.appendChild(el);
  state.totalTargets++;

  const life = isBonus ? config.targetLife * 0.7 : config.targetLife;
  setTimeout(() => {
    if (!el.parentNode) return;
    if (!isDecoy) { state.misses++; state.streak = 0; updateHUD(); }
    el.remove();
  }, life);
}

function hitTarget(el) {
  if (!state.running) return;
  const type = el.dataset.type;
  const reaction = Date.now() - parseInt(el.dataset.spawn);
  const r = el.getBoundingClientRect(), pr = playArea.getBoundingClientRect();
  const cx = r.left - pr.left + r.width / 2, cy = r.top - pr.top + r.height / 2;

  if (type === 'decoy') {
    state.score = Math.max(0, state.score - 50); state.streak = 0;
    showFx(cx, cy, '-50', 'penalty');
  } else {
    const base = type === 'bonus' ? 200 : 100;
    const pts = base + Math.floor(state.streak / 3) * 25 + (reaction < 500 ? 50 : reaction < 800 ? 25 : 0);
    state.score += pts; state.hits++; state.streak++;
    state.bestStreak = Math.max(state.bestStreak, state.streak);
    state.reactionTimes.push(reaction);
    showFx(cx, cy, '+' + pts, type === 'bonus' ? 'bonus' : 'normal');
  }
  el.remove(); updateHUD();
}

function onMouseClick(e) {
  if (!state.running || e.target.closest('.target')) return;
  state.misses++; state.streak = 0; updateHUD();
}

function showFx(x, y, text, type) {
  const ring = document.createElement('div');
  ring.className = `hit-effect ${type === 'bonus' ? 'bonus' : ''}`;
  ring.style.left = x + 'px'; ring.style.top = y + 'px';
  playArea.appendChild(ring); setTimeout(() => ring.remove(), 500);
  const s = document.createElement('div');
  s.className = `hit-score ${type}`; s.textContent = text;
  s.style.left = x + 'px'; s.style.top = (y - 20) + 'px';
  playArea.appendChild(s); setTimeout(() => s.remove(), 800);
}

function updateHUD() {
  $('scoreDisplay').textContent = state.score;
  $('streakDisplay').textContent = state.streak;
  $('missDisplay').textContent = state.misses;
  const t = state.hits + state.misses;
  $('accuracyDisplay').textContent = `ACC ${t > 0 ? Math.round((state.hits / t) * 100) : 100}%`;
}

function endGame() {
  state.screen = 'results';
  state.running = false;
  clearInterval(gameTimer); clearInterval(strobeTimer); clearInterval(spawnTimer);
  $('strobeOverlay').classList.remove('active');
  playArea.removeEventListener('click', onMouseClick);
  document.querySelectorAll('.target').forEach(t => t.remove());

  const total = state.hits + state.misses;
  const acc = total > 0 ? Math.round((state.hits / total) * 100) : 0;
  const avgR = state.reactionTimes.length > 0 ? Math.round(state.reactionTimes.reduce((a, b) => a + b, 0) / state.reactionTimes.length) : 0;

  let grade, gc, msg, rankLabel, rankColor;
  if (state.score >= 3000 && acc >= 85) { grade = 'S'; gc = 's-rank'; msg = 'Radiant-level cognitive performance'; rankLabel = 'RADIANT'; rankColor = 'var(--gold)'; }
  else if (state.score >= 2000 && acc >= 75) { grade = 'A'; gc = 'a-rank'; msg = 'Diamond-tier visual processing'; rankLabel = 'DIAMOND'; rankColor = 'var(--neon)'; }
  else if (state.score >= 1200 && acc >= 60) { grade = 'B'; gc = 'b-rank'; msg = 'Gold-level reaction speed'; rankLabel = 'GOLD'; rankColor = 'var(--electric)'; }
  else { grade = 'C'; gc = 'c-rank'; msg = 'Keep grinding ‚Äî neural pathways adapting'; rankLabel = 'SILVER'; rankColor = 'var(--text-mid)'; }

  $('resultRankLabel').textContent = rankLabel;
  $('resultRankLabel').style.color = rankColor;
  $('resultGrade').textContent = grade;
  $('resultGrade').className = `result-grade ${gc}`;
  $('resultMsg').textContent = msg;
  $('resultInputTag').textContent = `Played with: ${gp.connected ? 'Controller üéÆ' : 'Mouse üñ±Ô∏è'}`;
  $('resultScore').textContent = state.score;
  $('resultAccuracy').textContent = acc + '%';
  $('resultStreak').textContent = state.bestStreak;
  $('resultHits').textContent = state.hits;
  $('resultReaction').textContent = avgR + 'ms';
  $('resultTier').textContent = config.short;
  $('resultsScreen').classList.remove('hidden');

  // ‚îÄ‚îÄ‚îÄ SAVE SCORE TO SERVER ‚îÄ‚îÄ‚îÄ
  try {
    fetch('/api/scores', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        game: 'strobe',
        tier: state.tier,
        score: state.score,
        accuracy: acc,
        bestStreak: state.bestStreak,
        avgReaction: avgR,
        hits: state.hits,
        misses: state.misses,
        inputMode: gp.connected ? 'controller' : 'mouse',
        grade: grade
      })
    }).then(function() {}).catch(function() {});
  } catch (ignore) {}
}

function restartGame() {
  document.querySelectorAll('.target, .hit-effect, .hit-score').forEach(function(el) { el.remove(); });
  $('strobeOverlay').classList.remove('active');
  $('resultsScreen').classList.add('hidden');
  startCountdown();
}

function backToMenu() {
  state.screen = 'start';
  document.querySelectorAll('.target, .hit-effect, .hit-score').forEach(function(el) { el.remove(); });
  $('strobeOverlay').classList.remove('active');
  $('resultsScreen').classList.add('hidden');
  $('startScreen').classList.remove('hidden');
}
</script>

</body>
</html>
