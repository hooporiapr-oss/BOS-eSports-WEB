<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOS ESPORTS â€” Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #05060a;
    --bg-card: #0a0c14;
    --bg-surface: #0d1018;
    --neon: #00ff88;
    --neon-dim: rgba(0, 255, 136, 0.08);
    --neon-glow: rgba(0, 255, 136, 0.35);
    --electric: #00d4ff;
    --electric-dim: rgba(0, 212, 255, 0.08);
    --electric-glow: rgba(0, 212, 255, 0.3);
    --hot: #ff2d6b;
    --gold: #ffd54f;
    --gold-dim: rgba(255, 213, 79, 0.1);
    --gold-glow: rgba(255, 213, 79, 0.3);
    --text: #e8e6e1;
    --text-mid: #6b6e78;
    --text-dim: #2a2d36;
    --border: rgba(0, 255, 136, 0.06);
    --border-bright: rgba(0, 255, 136, 0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    -webkit-font-smoothing: antialiased;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
    pointer-events: none;
    z-index: 9998;
  }

  .nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--border);
    background: rgba(5,6,10,0.95);
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .nav-logo {
    font-family: 'Exo 2', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--neon);
    text-shadow: 0 0 15px var(--neon-glow);
    text-decoration: none;
  }

  .nav-right { display: flex; align-items: center; gap: 1.5rem; }

  .nav-user {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-mid);
    letter-spacing: 0.1em;
  }

  .nav-user strong { color: var(--neon); font-size: 0.75rem; }

  .nav-btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-dim);
    background: none;
    border: 1px solid var(--text-dim);
    padding: 0.3rem 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .nav-btn:hover { color: var(--hot); border-color: var(--hot); }

  .main { max-width: 1200px; margin: 0 auto; padding: 2rem; }

  .welcome { margin-bottom: 2.5rem; }

  .welcome h1 {
    font-family: 'Exo 2', sans-serif;
    font-weight: 700;
    font-size: 1.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .welcome h1 span { color: var(--neon); text-shadow: 0 0 15px var(--neon-glow); }

  .welcome p {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.7rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-top: 0.3rem;
  }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2.5rem;
  }

  .stat-box {
    border: 1px solid var(--border);
    background: var(--bg-card);
    padding: 1.5rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .stat-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--neon);
    opacity: 0.3;
  }

  .stat-val {
    font-family: 'Exo 2', sans-serif;
    font-weight: 800;
    font-size: 2rem;
    color: var(--neon);
    text-shadow: 0 0 15px var(--neon-glow);
    line-height: 1;
  }

  .stat-val.gold { color: var(--gold); text-shadow: 0 0 15px var(--gold-glow); }
  .stat-val.electric { color: var(--electric); text-shadow: 0 0 15px var(--electric-glow); }

  .stat-lbl {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 0.4rem;
  }

  .section-header {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.4em;
    text-transform: uppercase;
    color: var(--neon);
    text-shadow: 0 0 10px var(--neon-glow);
    margin-bottom: 1.5rem;
  }

  .section-header::before { content: '// '; opacity: 0.4; }

  .games-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin-bottom: 3rem;
  }

  .game-card {
    border: 1px solid var(--border);
    background: var(--bg-card);
    padding: 2rem;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    text-decoration: none;
    color: var(--text);
    display: block;
  }

  .game-card.live { cursor: pointer; }

  .game-card.live:hover {
    border-color: var(--neon);
    transform: translateY(-3px);
    box-shadow: 0 0 25px rgba(0,255,136,0.1), 0 15px 40px rgba(0,0,0,0.3);
  }

  .game-card.live::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--neon), var(--electric));
    box-shadow: 0 0 8px var(--neon-glow);
  }

  .game-card.locked { opacity: 0.35; cursor: default; }
  .game-card.locked::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--border); }

  .game-card .badge {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    padding: 0.2rem 0.6rem;
    display: inline-block;
    margin-bottom: 1rem;
  }

  .badge-live { color: var(--neon); background: var(--neon-dim); border: 1px solid rgba(0,255,136,0.2); }
  .badge-soon { color: var(--text-dim); border: 1px solid var(--border); }

  .game-card .icon { font-size: 2rem; margin-bottom: 0.8rem; display: block; }

  .game-card h3 {
    font-family: 'Exo 2', sans-serif;
    font-weight: 700;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.4rem;
  }

  .game-card p { color: var(--text-mid); font-size: 0.82rem; line-height: 1.6; }

  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .panel {
    border: 1px solid var(--border);
    background: var(--bg-card);
    padding: 1.5rem;
  }

  .panel-title {
    font-family: 'Exo 2', sans-serif;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1.2rem;
    color: var(--text-mid);
  }

  .lb-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
  }

  .lb-row:last-child { border-bottom: none; }

  .lb-rank {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-dim);
    width: 2rem;
  }

  .lb-rank.top-1 { color: var(--gold); }
  .lb-rank.top-2 { color: var(--electric); }
  .lb-rank.top-3 { color: var(--neon); }

  .lb-name {
    flex: 1;
    font-weight: 600;
    font-size: 0.85rem;
    padding: 0 0.8rem;
  }

  .lb-name.me { color: var(--neon); }

  .lb-score {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.7rem;
    color: var(--gold);
  }

  .lb-game {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    color: var(--text-dim);
    margin-left: 0.5rem;
  }

  .history-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border);
    font-size: 0.8rem;
  }

  .history-row:last-child { border-bottom: none; }

  .history-meta {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    color: var(--text-dim);
  }

  .history-right { display: flex; align-items: center; }

  .history-score { font-weight: 700; color: var(--gold); }
  .history-grade { font-weight: 700; margin-left: 0.5rem; }
  .history-grade.s { color: var(--gold); }
  .history-grade.a { color: var(--neon); }
  .history-grade.b { color: var(--electric); }
  .history-grade.c { color: var(--text-mid); }

  .empty-state {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-dim);
    text-align: center;
    padding: 2rem;
    letter-spacing: 0.1em;
  }

  @media (max-width: 768px) {
    .two-col { grid-template-columns: 1fr; }
    .nav { padding: 0.8rem 1.5rem; }
    .main { padding: 1.5rem; }
  }
</style>
</head>
<body>

<nav class="nav">
  <a href="/dashboard" class="nav-logo">BOS ESPORTS</a>
  <div class="nav-right">
    <span class="nav-user">Player: <strong id="navUsername">--</strong></span>
    <button class="nav-btn" id="logoutBtn">Logout</button>
  </div>
</nav>

<div class="main">
  <div class="welcome">
    <h1>Welcome back, <span id="welcomeName">Player</span></h1>
    <p id="sessionCount">Loading stats...</p>
  </div>

  <div class="stats-row">
    <div class="stat-box"><div class="stat-val" id="statSessions">0</div><div class="stat-lbl">Sessions</div></div>
    <div class="stat-box"><div class="stat-val gold" id="statBest">0</div><div class="stat-lbl">Best Score</div></div>
    <div class="stat-box"><div class="stat-val electric" id="statAccuracy">0%</div><div class="stat-lbl">Avg Accuracy</div></div>
    <div class="stat-box"><div class="stat-val" id="statReaction">0ms</div><div class="stat-lbl">Avg Reaction</div></div>
    <div class="stat-box"><div class="stat-val gold" id="statStreak">0</div><div class="stat-lbl">Best Streak</div></div>
  </div>

  <div class="section-header">Training Drills</div>
  <div class="games-row">
    <a href="/play/strobe" class="game-card live">
      <span class="badge badge-live">&#9679; Live</span>
      <span class="icon">&#128065;</span>
      <h3>Strobe Drill</h3>
      <p>Target acquisition under strobe disruption. Mouse + Controller supported.</p>
    </a>
    <a href="/play/flickshot" class="game-card live">
      <span class="badge badge-live">&#9679; Live</span>
      <span class="icon">&#127919;</span>
      <h3>FlickShot</h3>
      <p>Precision flick aim training. Moving targets, shrinking targets, distance scoring. Mouse + Controller.</p>
    </a>
    <div class="game-card locked">
      <span class="badge badge-soon">Coming Soon</span>
      <span class="icon">&#128260;</span>
      <h3>Split Focus</h3>
      <p>Multi-zone peripheral awareness training.</p>
    </div>
    <div class="game-card locked">
      <span class="badge badge-soon">Coming Soon</span>
      <span class="icon">&#9889;</span>
      <h3>Clutch Timer</h3>
      <p>Decision-making under extreme time pressure.</p>
    </div>
  </div>

  <div class="two-col">
    <div class="panel">
      <div class="panel-title">Global Leaderboard</div>
      <div id="leaderboard"><div class="empty-state">Loading leaderboard...</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">Your Recent Sessions</div>
      <div id="history"><div class="empty-state">Loading history...</div></div>
    </div>
  </div>
</div>

<script>
(function() {
  var navUsername = document.getElementById('navUsername');
  var welcomeName = document.getElementById('welcomeName');
  var sessionCount = document.getElementById('sessionCount');
  var statSessions = document.getElementById('statSessions');
  var statBest = document.getElementById('statBest');
  var statAccuracy = document.getElementById('statAccuracy');
  var statReaction = document.getElementById('statReaction');
  var statStreak = document.getElementById('statStreak');
  var leaderboardEl = document.getElementById('leaderboard');
  var historyEl = document.getElementById('history');
  var logoutBtn = document.getElementById('logoutBtn');

  function getGradeClass(grade) {
    if (grade === 'S') return 's';
    if (grade === 'A') return 'a';
    if (grade === 'B') return 'b';
    return 'c';
  }

  function getRankClass(index) {
    if (index === 0) return 'top-1';
    if (index === 1) return 'top-2';
    if (index === 2) return 'top-3';
    return '';
  }

  function getGameLabel(game) {
    if (game === 'flickshot') return 'FLK';
    return 'STR';
  }

  function getInputLabel(mode) {
    if (mode === 'controller') return 'PAD';
    return 'MKB';
  }

  function formatDate(dateStr) {
    try {
      var d = new Date(dateStr);
      var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      return months[d.getMonth()] + ' ' + d.getDate();
    } catch (e) {
      return '--';
    }
  }

  function renderLeaderboard(scores, userId) {
    if (!scores || scores.length === 0) {
      leaderboardEl.innerHTML = '<div class="empty-state">No scores yet - be the first!</div>';
      return;
    }
    var html = '';
    for (var i = 0; i < scores.length; i++) {
      var s = scores[i];
      var rankClass = getRankClass(i);
      var nameClass = (s.userId === userId) ? ' me' : '';
      var gameLabel = getGameLabel(s.game);
      html += '<div class="lb-row">';
      html += '<span class="lb-rank ' + rankClass + '">#' + (i + 1) + '</span>';
      html += '<span class="lb-name' + nameClass + '">' + (s.username || 'Player') + '</span>';
      html += '<span class="lb-game">' + gameLabel + '</span>';
      html += '<span class="lb-score">' + (s.score || 0) + '</span>';
      html += '</div>';
    }
    leaderboardEl.innerHTML = html;
  }

  function renderHistory(scores) {
    if (!scores || scores.length === 0) {
      historyEl.innerHTML = '<div class="empty-state">No sessions yet - start training!</div>';
      return;
    }
    var html = '';
    for (var i = 0; i < scores.length; i++) {
      var sc = scores[i];
      var date = formatDate(sc.createdAt);
      var gc = getGradeClass(sc.grade);
      var gameLabel = getGameLabel(sc.game);
      var inputLabel = getInputLabel(sc.inputMode);
      html += '<div class="history-row">';
      html += '<span class="history-meta">' + date + ' | ' + gameLabel + ' | T' + (sc.tier || 1) + ' | ' + inputLabel + '</span>';
      html += '<span class="history-right">';
      html += '<span class="history-score">' + (sc.score || 0) + '</span>';
      html += '<span class="history-grade ' + gc + '">' + (sc.grade || 'C') + '</span>';
      html += '</span>';
      html += '</div>';
    }
    historyEl.innerHTML = html;
  }

  function showDefaults() {
    leaderboardEl.innerHTML = '<div class="empty-state">No scores yet - be the first!</div>';
    historyEl.innerHTML = '<div class="empty-state">No sessions yet - start training!</div>';
    sessionCount.textContent = '0 training sessions completed';
  }

  function loadDashboard() {
    try {
      fetch('/api/dashboard')
        .then(function(res) {
          if (!res.ok) { showDefaults(); return null; }
          return res.json();
        })
        .then(function(data) {
          if (!data) return;
          if (!data.user) {
            window.location.href = '/';
            return;
          }

          var username = data.user.username || 'Player';
          navUsername.textContent = username;
          welcomeName.textContent = username;

          var s = data.stats || {};
          var sessions = s.sessions || 0;
          statSessions.textContent = sessions;
          statBest.textContent = s.bestScore || 0;
          statAccuracy.textContent = (s.avgAccuracy || 0) + '%';
          statReaction.textContent = (s.avgReaction || 0) + 'ms';
          statStreak.textContent = s.bestStreak || 0;
          sessionCount.textContent = sessions + ' training sessions completed';

          renderLeaderboard(data.topScores, data.user.id);
          renderHistory(s.recentScores);
        })
        .catch(function() {
          showDefaults();
        });
    } catch (e) {
      showDefaults();
    }
  }

  logoutBtn.addEventListener('click', function() {
    try {
      fetch('/auth/logout', { method: 'POST' })
        .then(function() { window.location.href = '/'; })
        .catch(function() { window.location.href = '/'; });
    } catch (e) {
      window.location.href = '/';
    }
  });

  loadDashboard();
})();
</script>

</body>
</html>
