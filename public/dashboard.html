<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOS ESPORTS — Dashboard</title>
<meta name="description" content="BOS Esports neurocognitive performance training dashboard.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
    :root {
        --gold: #FFD700;
        --gold-dim: rgba(255, 215, 0, 0.1);
        --gold-glow: rgba(255, 215, 0, 0.3);
        --orange: #FF6B35;
        --teal: #00D9A5;
        --cyan: #00CED1;
        --red: #FF1744;
        --dark: #0a0a0f;
        --darker: #050508;
        --card: #111118;
        --text: #FFFFFF;
        --muted: #8892a0;
        --border: rgba(255,255,255,0.08);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: 'Outfit', sans-serif;
        background: var(--dark);
        color: var(--text);
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
    }

    /* ===== TOP NAV BAR ===== */
    .top-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: var(--darker);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .nav-logo {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.3rem;
        letter-spacing: 4px;
        color: var(--gold);
        text-decoration: none;
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .nav-user {
        font-size: 0.75rem;
        color: var(--muted);
    }

    .nav-user strong {
        color: var(--gold);
    }

    .nav-btn {
        padding: 6px 14px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: transparent;
        color: var(--muted);
        font-family: 'Outfit', sans-serif;
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .nav-btn:hover {
        color: var(--red);
        border-color: var(--red);
    }

    /* ===== MAIN ===== */
    .main {
        flex: 1;
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px 15px 40px;
        width: 100%;
    }

    /* ===== WELCOME ===== */
    .welcome {
        margin-bottom: 20px;
    }

    .welcome h1 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem;
        letter-spacing: 3px;
    }

    .welcome h1 span {
        color: var(--gold);
    }

    .welcome p {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 2px;
    }

    /* ===== STATS ROW ===== */
    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-bottom: 25px;
    }

    .stat-box {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 16px;
        padding: 18px 14px;
        text-align: center;
        transition: all 0.3s;
    }

    .stat-box:hover {
        border-color: rgba(255, 215, 0, 0.2);
        box-shadow: 0 4px 20px rgba(255, 215, 0, 0.05);
    }

    .stat-val {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem;
        letter-spacing: 2px;
        line-height: 1;
        color: var(--gold);
    }

    .stat-val.teal { color: var(--teal); }
    .stat-val.cyan { color: var(--cyan); }
    .stat-val.orange { color: var(--orange); }

    .stat-lbl {
        font-size: 0.6rem;
        font-weight: 600;
        letter-spacing: 2px;
        text-transform: uppercase;
        color: var(--muted);
        margin-top: 6px;
    }

    /* ===== SECTION HEADER ===== */
    .section-header {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.3rem;
        letter-spacing: 3px;
        color: var(--gold);
        margin-bottom: 15px;
    }

    /* ===== GAME CARDS ===== */
    .games-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 12px;
        margin-bottom: 30px;
    }

    .game-card {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 20px;
        padding: 25px 20px;
        text-decoration: none;
        color: var(--text);
        display: block;
        transition: all 0.3s;
    }

    .game-card.live:hover {
        border-color: var(--gold);
        transform: translateY(-3px);
        box-shadow: 0 10px 40px rgba(255, 215, 0, 0.1);
    }

    .game-card.locked {
        opacity: 0.35;
        cursor: default;
    }

    .game-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 50px;
        font-size: 0.55rem;
        font-weight: 700;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        margin-bottom: 12px;
    }

    .badge-live {
        color: var(--dark);
        background: linear-gradient(135deg, var(--gold), var(--orange));
    }

    .badge-new {
        color: var(--dark);
        background: linear-gradient(135deg, var(--teal), var(--cyan));
    }

    .badge-soon {
        color: var(--muted);
        border: 1px solid var(--border);
    }

    .game-icon {
        font-size: 2rem;
        display: block;
        margin-bottom: 8px;
    }

    .game-card h3 {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.25rem;
        letter-spacing: 2px;
        margin-bottom: 4px;
    }

    .game-card p {
        font-size: 0.78rem;
        color: var(--muted);
        line-height: 1.5;
    }

    /* ===== TWO COL PANELS ===== */
    .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .panel {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: 20px;
        padding: 22px 18px;
    }

    .panel-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.1rem;
        letter-spacing: 2px;
        color: var(--gold);
        margin-bottom: 14px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
    }

    /* ===== LEADERBOARD ===== */
    .lb-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
    }

    .lb-row:last-child { border-bottom: none; }

    .lb-rank {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 0.9rem;
        color: var(--muted);
        width: 2rem;
        letter-spacing: 1px;
    }

    .lb-rank.top-1 { color: var(--gold); }
    .lb-rank.top-2 { color: var(--teal); }
    .lb-rank.top-3 { color: var(--orange); }

    .lb-name {
        flex: 1;
        font-weight: 600;
        font-size: 0.85rem;
        padding: 0 8px;
    }

    .lb-name.me { color: var(--gold); }

    .lb-score {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1rem;
        color: var(--gold);
        letter-spacing: 1px;
    }

    .lb-game {
        font-size: 0.55rem;
        font-weight: 600;
        color: var(--muted);
        margin-left: 8px;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    /* ===== HISTORY ===== */
    .history-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
        font-size: 0.8rem;
    }

    .history-row:last-child { border-bottom: none; }

    .history-meta {
        font-size: 0.6rem;
        font-weight: 500;
        color: var(--muted);
        letter-spacing: 0.5px;
    }

    .history-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .history-score {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1rem;
        color: var(--gold);
        letter-spacing: 1px;
    }

    .history-grade {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 0.9rem;
        letter-spacing: 1px;
    }

    .history-grade.s { color: var(--gold); }
    .history-grade.a { color: var(--teal); }
    .history-grade.b { color: var(--cyan); }
    .history-grade.c { color: var(--muted); }

    .empty-state {
        font-size: 0.8rem;
        color: var(--muted);
        text-align: center;
        padding: 30px 15px;
    }

    /* ===== FOOTER ===== */
    .footer {
        padding: 30px 20px;
        text-align: center;
        background: var(--darker);
        border-top: 1px solid var(--border);
    }

    .footer-logo {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.1rem;
        letter-spacing: 3px;
        margin-bottom: 8px;
        color: var(--gold);
    }

    .footer-links {
        margin: 10px 0;
        font-size: 0.65rem;
    }

    .footer-links a {
        color: var(--muted);
        text-decoration: none;
        margin: 0 8px;
        transition: color 0.3s;
    }

    .footer-links a:hover {
        color: var(--gold);
    }

    .footer-company {
        font-size: 0.65rem;
        color: var(--muted);
    }

    .footer-trademarks {
        font-size: 0.55rem;
        color: var(--muted);
        margin-top: 12px;
        padding: 0 15px;
        line-height: 1.5;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
        .two-col { grid-template-columns: 1fr; }
        .games-row { grid-template-columns: 1fr; }
        .stats-row { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 380px) {
        .welcome h1 { font-size: 1.6rem; }
        .stat-val { font-size: 1.6rem; }
        .stats-row { grid-template-columns: repeat(2, 1fr); }
    }
</style>
</head>
<body>

<!-- ===== TOP NAV BAR ===== -->
<nav class="top-nav">
    <a href="/dashboard" class="nav-logo">BOS ESPORTS</a>
    <div class="nav-right">
        <span class="nav-user">Player: <strong id="navUsername">--</strong></span>
        <button class="nav-btn" id="logoutBtn">Logout</button>
    </div>
</nav>

<!-- ===== MAIN ===== -->
<div class="main">

    <!-- WELCOME -->
    <div class="welcome">
        <h1>WELCOME BACK, <span id="welcomeName">PLAYER</span></h1>
        <p id="sessionCount">Loading stats...</p>
    </div>

    <!-- STATS -->
    <div class="stats-row">
        <div class="stat-box">
            <div class="stat-val" id="statSessions">0</div>
            <div class="stat-lbl">Sessions</div>
        </div>
        <div class="stat-box">
            <div class="stat-val orange" id="statBest">0</div>
            <div class="stat-lbl">Best Score</div>
        </div>
        <div class="stat-box">
            <div class="stat-val teal" id="statAccuracy">0%</div>
            <div class="stat-lbl">Avg Accuracy</div>
        </div>
        <div class="stat-box">
            <div class="stat-val cyan" id="statReaction">0ms</div>
            <div class="stat-lbl">Avg Reaction</div>
        </div>
        <div class="stat-box">
            <div class="stat-val" id="statStreak">0</div>
            <div class="stat-lbl">Best Streak</div>
        </div>
    </div>

    <!-- TRAINING DRILLS -->
    <div class="section-header">&#127918; Training Drills</div>
    <div class="games-row">
        <a href="/play/strobe" class="game-card live">
            <span class="game-badge badge-live">&#9679; Live</span>
            <span class="game-icon">&#128065;</span>
            <h3>Strobe Drill</h3>
            <p>Visual processing under strobe disruption. Train focus and spatial awareness. Mouse + Controller.</p>
        </a>
        <a href="/play/flickshot" class="game-card live">
            <span class="game-badge badge-live">&#9679; Live</span>
            <span class="game-icon">&#127919;</span>
            <h3>FlickShot</h3>
            <p>Precision flick aim training. Moving targets, shrinking targets, distance scoring. Mouse + Controller.</p>
        </a>
        <a href="/play/split-focus" class="game-card live">
            <span class="game-badge badge-new">&#9733; New</span>
            <span class="game-icon">&#129504;</span>
            <h3>Split Focus</h3>
            <p>Divided attention and cognitive flexibility. Track targets, ignore decoys, adapt to rule switches. Mouse + Controller.</p>
        </a>
        <div class="game-card locked">
            <span class="game-badge badge-soon">Coming Soon</span>
            <span class="game-icon">&#9889;</span>
            <h3>Clutch Timer</h3>
            <p>Decision-making under extreme time pressure.</p>
        </div>
    </div>

    <!-- LEADERBOARD + HISTORY -->
    <div class="two-col">
        <div class="panel">
            <div class="panel-title">&#127942; Global Leaderboard</div>
            <div id="leaderboard"><div class="empty-state">Loading leaderboard...</div></div>
        </div>
        <div class="panel">
            <div class="panel-title">&#128202; Your Recent Sessions</div>
            <div id="history"><div class="empty-state">Loading history...</div></div>
        </div>
    </div>
</div>

<!-- ===== FOOTER ===== -->
<footer class="footer">
    <div class="footer-logo">BOS ESPORTS</div>
    <div class="footer-links">
        <a href="privacy.html">Privacy Policy</a>
        <a href="terms.html">Terms of Use</a>
    </div>
    <div class="footer-company">&copy; 2026 GoStar Digital LLC. All Rights Reserved. &#127477;&#127479;</div>
    <div class="footer-trademarks">BOS Esports&trade; is a trademark of GoStar Digital LLC.</div>
</footer>

<script>
(function() {
    var navUsername = document.getElementById('navUsername');
    var welcomeName = document.getElementById('welcomeName');
    var sessionCount = document.getElementById('sessionCount');
    var statSessions = document.getElementById('statSessions');
    var statBest = document.getElementById('statBest');
    var statAccuracy = document.getElementById('statAccuracy');
    var statReaction = document.getElementById('statReaction');
    var statStreak = document.getElementById('statStreak');
    var leaderboardEl = document.getElementById('leaderboard');
    var historyEl = document.getElementById('history');
    var logoutBtn = document.getElementById('logoutBtn');

    function getGradeClass(grade) {
        if (grade === 'S') return 's';
        if (grade === 'A') return 'a';
        if (grade === 'B') return 'b';
        return 'c';
    }

    function getRankClass(index) {
        if (index === 0) return 'top-1';
        if (index === 1) return 'top-2';
        if (index === 2) return 'top-3';
        return '';
    }

    function getGameLabel(game) {
        if (game === 'flickshot') return 'FLK';
        if (game === 'splitfocus') return 'SPF';
        return 'STR';
    }

    function getInputLabel(mode) {
        if (mode === 'controller') return 'PAD';
        return 'MKB';
    }

    function formatDate(dateStr) {
        try {
            var d = new Date(dateStr);
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            return months[d.getMonth()] + ' ' + d.getDate();
        } catch (e) {
            return '--';
        }
    }

    function renderLeaderboard(scores, userId) {
        if (!scores || scores.length === 0) {
            leaderboardEl.innerHTML = '<div class="empty-state">No scores yet — be the first! &#127942;</div>';
            return;
        }
        var html = '';
        for (var i = 0; i < scores.length; i++) {
            var s = scores[i];
            var rankClass = getRankClass(i);
            var nameClass = (s.userId === userId) ? ' me' : '';
            var gameLabel = getGameLabel(s.game);
            html += '<div class="lb-row">';
            html += '<span class="lb-rank ' + rankClass + '">#' + (i + 1) + '</span>';
            html += '<span class="lb-name' + nameClass + '">' + (s.username || 'Player') + '</span>';
            html += '<span class="lb-game">' + gameLabel + '</span>';
            html += '<span class="lb-score">' + (s.score || 0) + '</span>';
            html += '</div>';
        }
        leaderboardEl.innerHTML = html;
    }

    function renderHistory(scores) {
        if (!scores || scores.length === 0) {
            historyEl.innerHTML = '<div class="empty-state">No sessions yet — start training! &#128170;</div>';
            return;
        }
        var html = '';
        for (var i = 0; i < scores.length; i++) {
            var sc = scores[i];
            var date = formatDate(sc.createdAt);
            var gc = getGradeClass(sc.grade);
            var gameLabel = getGameLabel(sc.game);
            var inputLabel = getInputLabel(sc.inputMode);
            html += '<div class="history-row">';
            html += '<span class="history-meta">' + date + ' | ' + gameLabel + ' | T' + (sc.tier || 1) + ' | ' + inputLabel + '</span>';
            html += '<span class="history-right">';
            html += '<span class="history-score">' + (sc.score || 0) + '</span>';
            html += '<span class="history-grade ' + gc + '">' + (sc.grade || 'C') + '</span>';
            html += '</span>';
            html += '</div>';
        }
        historyEl.innerHTML = html;
    }

    function showDefaults() {
        leaderboardEl.innerHTML = '<div class="empty-state">No scores yet — be the first! &#127942;</div>';
        historyEl.innerHTML = '<div class="empty-state">No sessions yet — start training! &#128170;</div>';
        sessionCount.textContent = '0 training sessions completed';
    }

    function loadDashboard() {
        try {
            fetch('/api/dashboard')
                .then(function(res) {
                    if (!res.ok) { showDefaults(); return null; }
                    return res.json();
                })
                .then(function(data) {
                    if (!data) return;
                    if (!data.user) {
                        window.location.href = '/';
                        return;
                    }

                    var username = data.user.username || 'Player';
                    navUsername.textContent = username;
                    welcomeName.textContent = username.toUpperCase();

                    var s = data.stats || {};
                    var sessions = s.sessions || 0;
                    statSessions.textContent = sessions;
                    statBest.textContent = s.bestScore || 0;
                    statAccuracy.textContent = (s.avgAccuracy || 0) + '%';
                    statReaction.textContent = (s.avgReaction || 0) + 'ms';
                    statStreak.textContent = s.bestStreak || 0;
                    sessionCount.textContent = sessions + ' training sessions completed';

                    renderLeaderboard(data.topScores, data.user.id);
                    renderHistory(s.recentScores);
                })
                .catch(function() {
                    showDefaults();
                });
        } catch (e) {
            showDefaults();
        }
    }

    logoutBtn.addEventListener('click', function() {
        try {
            fetch('/auth/logout', { method: 'POST' })
                .then(function() { window.location.href = '/'; })
                .catch(function() { window.location.href = '/'; });
        } catch (e) {
            window.location.href = '/';
        }
    });

    loadDashboard();
})();
</script>

</body>
</html>