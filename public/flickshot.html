<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOS ESPORTS ‚Äî FlickShot</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #05060a;
    --bg-surface: #0a0c14;
    --bg-card: #0d1018;
    --neon: #00ff88;
    --neon-dim: rgba(0, 255, 136, 0.08);
    --neon-glow: rgba(0, 255, 136, 0.35);
    --electric: #00d4ff;
    --electric-dim: rgba(0, 212, 255, 0.08);
    --electric-glow: rgba(0, 212, 255, 0.3);
    --hot: #ff2d6b;
    --hot-dim: rgba(255, 45, 107, 0.08);
    --hot-glow: rgba(255, 45, 107, 0.3);
    --gold: #ffd54f;
    --gold-glow: rgba(255, 213, 79, 0.3);
    --purple: #b44dff;
    --purple-dim: rgba(180, 77, 255, 0.08);
    --purple-glow: rgba(180, 77, 255, 0.3);
    --text: #e8e6e1;
    --text-mid: #6b6e78;
    --text-dim: #2a2d36;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Exo 2', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    -webkit-font-smoothing: antialiased;
    user-select: none;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  .game-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }

  /* ‚îÄ‚îÄ‚îÄ HUD ‚îÄ‚îÄ‚îÄ */
  .hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid rgba(0,255,136,0.06);
    background: rgba(5,6,10,0.95);
    z-index: 10;
    flex-shrink: 0;
  }

  .hud-left { display: flex; align-items: center; gap: 1rem; }

  .back-btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-mid);
    background: transparent;
    border: 1px solid var(--text-dim);
    padding: 0.3rem 0.7rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .back-btn:hover { color: var(--neon); border-color: var(--neon); background: var(--neon-dim); }

  .hud-logo {
    font-weight: 800;
    font-size: 0.9rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--neon);
    text-shadow: 0 0 15px var(--neon-glow);
  }

  .hud-logo span { color: var(--text-dim); font-weight: 400; font-size: 0.75rem; text-shadow: none; }

  .hud-rank {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--electric);
    background: var(--electric-dim);
    padding: 0.25rem 0.7rem;
  }

  .hud-center { display: flex; gap: 2.5rem; align-items: center; }
  .hud-stat { text-align: center; }

  .hud-stat-value { font-weight: 700; font-size: 1.3rem; line-height: 1; letter-spacing: 0.02em; }
  .hud-stat-value.score-val { color: var(--gold); text-shadow: 0 0 10px var(--gold-glow); }
  .hud-stat-value.streak-val { color: var(--neon); text-shadow: 0 0 8px var(--neon-glow); }
  .hud-stat-value.miss-val { color: var(--hot); }
  .hud-stat-value.time-val { color: var(--text); }

  .hud-stat-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.45rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 0.15rem;
  }

  .hud-right { display: flex; align-items: center; gap: 1rem; }

  .input-indicator {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.2rem 0.6rem;
    border: 1px solid var(--text-dim);
    transition: all 0.3s ease;
  }

  .input-indicator.controller-active { color: var(--neon); border-color: rgba(0,255,136,0.2); background: var(--neon-dim); }
  .input-indicator.mouse-active { color: var(--text-mid); border-color: var(--text-dim); }
  .input-icon { font-size: 0.75rem; }

  .mode-badge {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    color: var(--purple);
    background: var(--purple-dim);
    padding: 0.2rem 0.6rem;
    border: 1px solid rgba(180,77,255,0.2);
  }

  /* ‚îÄ‚îÄ‚îÄ PLAY AREA ‚îÄ‚îÄ‚îÄ */
  .play-area {
    flex: 1;
    position: relative;
    overflow: hidden;
    cursor: crosshair;
  }

  .play-area.controller-mode { cursor: none; }

  .grid-overlay {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,136,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,136,0.02) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  /* Origin marker ‚Äî where you flick FROM */
  .origin-marker {
    position: absolute;
    z-index: 2;
    pointer-events: none;
    display: none;
  }

  .origin-marker.visible { display: block; }

  .origin-ring {
    width: 24px; height: 24px;
    border-radius: 50%;
    border: 1px solid rgba(0,255,136,0.3);
    position: relative;
  }

  .origin-ring::before, .origin-ring::after {
    content: '';
    position: absolute;
    background: rgba(0,255,136,0.2);
  }

  .origin-ring::before { width: 12px; height: 1px; top: 11px; left: 6px; }
  .origin-ring::after { width: 1px; height: 12px; top: 6px; left: 11px; }

  /* ‚îÄ‚îÄ‚îÄ TARGETS ‚îÄ‚îÄ‚îÄ */
  .flick-target {
    position: absolute;
    z-index: 3;
    cursor: crosshair;
    transition: width 0.1s, height 0.1s;
  }

  .flick-target-ring {
    width: 100%; height: 100%;
    border-radius: 50%;
    border: 2px solid var(--electric);
    background: var(--electric-dim);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 0 15px var(--electric-glow), inset 0 0 15px rgba(0,212,255,0.05);
    animation: targetGlow 0.6s ease-in-out infinite alternate;
  }

  .flick-target-ring::before {
    content: '';
    position: absolute;
    inset: -6px;
    border-radius: 50%;
    border: 1px solid rgba(0,212,255,0.1);
    animation: targetExpand 1s ease-out infinite;
  }

  /* Target inner dot */
  .flick-target-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--electric);
    box-shadow: 0 0 8px var(--electric-glow);
  }

  /* Shrinking target ‚Äî adds urgency ring */
  .flick-target.shrinking .flick-target-ring {
    border-color: var(--hot);
    background: var(--hot-dim);
    box-shadow: 0 0 15px var(--hot-glow), inset 0 0 15px rgba(255,45,107,0.05);
  }

  .flick-target.shrinking .flick-target-dot { background: var(--hot); box-shadow: 0 0 8px var(--hot-glow); }
  .flick-target.shrinking .flick-target-ring::before { border-color: rgba(255,45,107,0.1); }

  /* Moving target */
  .flick-target.moving .flick-target-ring {
    border-color: var(--purple);
    background: var(--purple-dim);
    box-shadow: 0 0 15px var(--purple-glow), inset 0 0 15px rgba(180,77,255,0.05);
  }

  .flick-target.moving .flick-target-dot { background: var(--purple); box-shadow: 0 0 8px var(--purple-glow); }
  .flick-target.moving .flick-target-ring::before { border-color: rgba(180,77,255,0.1); }

  /* Precision bonus ‚Äî small gold target */
  .flick-target.precision .flick-target-ring {
    border-color: var(--gold);
    background: var(--gold-dim);
    box-shadow: 0 0 15px var(--gold-glow), inset 0 0 10px rgba(255,213,79,0.05);
  }

  .flick-target.precision .flick-target-dot { background: var(--gold); box-shadow: 0 0 8px var(--gold-glow); }
  .flick-target.precision .flick-target-ring::before { border-color: rgba(255,213,79,0.1); }

  /* Flick line ‚Äî shows the distance you flicked */
  .flick-line {
    position: absolute;
    height: 1px;
    background: linear-gradient(90deg, var(--neon), transparent);
    box-shadow: 0 0 4px var(--neon-glow);
    transform-origin: left center;
    z-index: 1;
    pointer-events: none;
    animation: flickFade 0.5s ease-out forwards;
  }

  .hit-effect {
    position: absolute;
    border-radius: 50%;
    border: 2px solid var(--electric);
    box-shadow: 0 0 20px var(--electric-glow);
    transform: translate(-50%, -50%);
    animation: hitBurst 0.5s ease-out forwards;
    pointer-events: none;
    z-index: 4;
  }

  .hit-score {
    position: absolute;
    transform: translate(-50%, -50%);
    font-family: 'Exo 2', sans-serif;
    font-weight: 800;
    font-size: 1.2rem;
    color: var(--gold);
    text-shadow: 0 0 15px var(--gold-glow);
    animation: scoreFloat 0.8s ease-out forwards;
    pointer-events: none;
    z-index: 6;
  }

  .hit-score.precision-hit { color: var(--gold); font-size: 1.5rem; }
  .hit-score.miss-hit { color: var(--hot); text-shadow: 0 0 10px var(--hot-glow); }

  /* Distance bonus indicator */
  .distance-tag {
    position: absolute;
    transform: translate(-50%, -50%);
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.1em;
    color: var(--neon);
    text-shadow: 0 0 8px var(--neon-glow);
    animation: scoreFloat 1s ease-out 0.1s forwards;
    pointer-events: none;
    z-index: 6;
    opacity: 0.8;
  }

  /* ‚îÄ‚îÄ‚îÄ GAMEPAD CROSSHAIR ‚îÄ‚îÄ‚îÄ */
  .gamepad-crosshair {
    position: absolute;
    z-index: 8;
    pointer-events: none;
    display: none;
    transform: translate(-50%, -50%);
  }

  .gamepad-crosshair.visible { display: block; }

  .crosshair-outer { width: 40px; height: 40px; position: relative; }

  .crosshair-outer::before {
    content: '';
    position: absolute;
    top: 19px; left: 0;
    width: 14px; height: 2px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow);
  }

  .crosshair-outer::after {
    content: '';
    position: absolute;
    top: 19px; right: 0;
    width: 14px; height: 2px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow);
  }

  .crosshair-v-top, .crosshair-v-bottom {
    position: absolute;
    left: 19px;
    width: 2px;
    height: 14px;
    background: var(--neon);
    box-shadow: 0 0 8px var(--neon-glow);
  }

  .crosshair-v-top { top: 0; }
  .crosshair-v-bottom { bottom: 0; }

  .crosshair-dot {
    position: absolute;
    top: 18px; left: 18px;
    width: 4px; height: 4px;
    border-radius: 50%;
    background: var(--neon);
    box-shadow: 0 0 10px var(--neon-glow);
  }

  .crosshair-flash {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    border: 1px solid var(--neon);
    border-radius: 50%;
    opacity: 0;
    box-shadow: 0 0 20px var(--neon-glow);
  }

  .crosshair-flash.firing { animation: crosshairFire 0.2s ease-out forwards; }

  .gamepad-crosshair.on-target .crosshair-outer::before,
  .gamepad-crosshair.on-target .crosshair-outer::after,
  .gamepad-crosshair.on-target .crosshair-v-top,
  .gamepad-crosshair.on-target .crosshair-v-bottom { background: var(--hot); box-shadow: 0 0 8px var(--hot-glow); }
  .gamepad-crosshair.on-target .crosshair-dot { background: var(--hot); box-shadow: 0 0 10px var(--hot-glow); }

  /* ‚îÄ‚îÄ‚îÄ BOTTOM BAR ‚îÄ‚îÄ‚îÄ */
  .bottom-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.7rem 1.5rem;
    border-top: 1px solid rgba(0,255,136,0.06);
    background: rgba(5,6,10,0.95);
    z-index: 10;
    flex-shrink: 0;
  }

  .flick-indicator { display: flex; align-items: center; gap: 0.5rem; }

  .flick-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--electric);
    box-shadow: 0 0 8px var(--electric-glow);
    animation: strobeBlink 1.5s ease-in-out infinite;
  }

  .flick-text {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-mid);
  }

  .progress-section { display: flex; align-items: center; gap: 1rem; }

  .progress-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
  }

  .progress-track { width: 120px; height: 3px; background: rgba(255,255,255,0.04); overflow: hidden; }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--electric), var(--neon));
    box-shadow: 0 0 6px var(--electric-glow);
    transition: width 0.3s ease;
  }

  .accuracy-display {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--electric);
    letter-spacing: 0.08em;
    text-shadow: 0 0 8px var(--electric-glow);
  }

  /* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
  .screen-overlay {
    position: absolute;
    inset: 0;
    z-index: 20;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(5, 6, 10, 0.97);
    backdrop-filter: blur(20px);
    text-align: center;
    padding: 2rem;
  }

  .screen-overlay.hidden { display: none; }

  .start-icon { font-size: 3.5rem; margin-bottom: 1.5rem; animation: float 3s ease-in-out infinite; }

  .start-title {
    font-weight: 900;
    font-size: clamp(2.5rem, 6vw, 4rem);
    text-transform: uppercase;
    line-height: 0.95;
    letter-spacing: 0.02em;
  }

  .start-title .glow {
    display: block;
    color: var(--electric);
    text-shadow: 0 0 30px var(--electric-glow), 0 0 60px rgba(0,212,255,0.1);
  }

  .start-desc {
    color: var(--text-mid);
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.72rem;
    line-height: 1.8;
    max-width: 460px;
    margin: 1.5rem 0 1.5rem;
    letter-spacing: 0.02em;
  }

  .input-hint {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .input-hint-item { display: flex; align-items: center; gap: 0.4rem; }
  .input-hint-item .icon { font-size: 0.85rem; }
  .input-hint-item.active { color: var(--neon); }

  .tier-select { display: flex; gap: 0.4rem; margin-bottom: 2rem; flex-wrap: wrap; justify-content: center; }

  .tier-btn {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    background: transparent;
    color: var(--text-dim);
    border: 1px solid rgba(255,255,255,0.06);
    padding: 0.45rem 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tier-btn.active { color: var(--electric); border-color: var(--electric); background: var(--electric-dim); box-shadow: 0 0 10px rgba(0,212,255,0.1); }
  .tier-btn:hover:not(.active) { border-color: rgba(255,255,255,0.12); color: var(--text-mid); }

  .start-btn {
    font-family: 'Exo 2', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    background: var(--electric);
    color: var(--bg);
    border: none;
    padding: 1rem 3rem;
    cursor: pointer;
    transition: all 0.3s ease;
    clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
  }

  .start-btn:hover { box-shadow: 0 0 40px var(--electric-glow); transform: translateY(-2px); }

  .btn-back-home {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-dim);
    text-decoration: none;
    transition: color 0.2s;
    margin-top: 1.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .btn-back-home:hover { color: var(--electric); }

  .countdown-num {
    font-weight: 900;
    font-size: 8rem;
    color: var(--electric);
    text-shadow: 0 0 60px var(--electric-glow), 0 0 120px rgba(0,212,255,0.15);
    line-height: 1;
    animation: countPop 0.5s ease-out;
  }

  .countdown-sub {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 1rem;
  }

  /* Results */
  .results-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    background: rgba(0,212,255,0.04);
    border: 1px solid rgba(0,212,255,0.06);
    max-width: 480px;
    width: 100%;
    margin: 2rem 0;
  }

  .result-cell { background: var(--bg-card); padding: 1.5rem 1rem; text-align: center; }
  .result-value { font-weight: 800; font-size: 1.8rem; line-height: 1; }
  .result-value.gold { color: var(--gold); text-shadow: 0 0 10px var(--gold-glow); }
  .result-value.neon { color: var(--neon); text-shadow: 0 0 10px var(--neon-glow); }
  .result-value.electric { color: var(--electric); text-shadow: 0 0 10px var(--electric-glow); }

  .result-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.45rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 0.3rem;
  }

  .result-grade { font-size: 4.5rem; font-weight: 900; line-height: 1; margin-bottom: 0.3rem; }
  .result-grade.s-rank { color: var(--gold); text-shadow: 0 0 40px var(--gold-glow); }
  .result-grade.a-rank { color: var(--neon); text-shadow: 0 0 30px var(--neon-glow); }
  .result-grade.b-rank { color: var(--electric); text-shadow: 0 0 20px var(--electric-glow); }
  .result-grade.c-rank { color: var(--text-mid); }

  .result-rank {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .result-msg {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.65rem;
    color: var(--text-mid);
    letter-spacing: 0.1em;
    margin-bottom: 1.5rem;
  }

  .result-input-tag {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 1rem;
  }

  .btn-group { display: flex; gap: 0.8rem; flex-wrap: wrap; justify-content: center; }

  .btn-secondary {
    font-family: 'Exo 2', sans-serif;
    font-weight: 600;
    font-size: 0.8rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    background: transparent;
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.08);
    padding: 0.7rem 1.8rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    display: inline-block;
    text-align: center;
  }

  .btn-secondary:hover { border-color: var(--electric); color: var(--electric); background: var(--electric-dim); }

  .gp-hints {
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.5rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-top: 1rem;
    display: none;
  }

  .gp-hints.visible { display: block; }

  .gp-hint-key {
    display: inline-block;
    border: 1px solid var(--text-dim);
    padding: 0.15rem 0.4rem;
    margin: 0 0.2rem;
    font-size: 0.5rem;
    border-radius: 2px;
  }

  /* ‚îÄ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ‚îÄ */
  @keyframes targetGlow { 0% { box-shadow: 0 0 10px var(--electric-glow); } 100% { box-shadow: 0 0 25px var(--electric-glow); } }
  @keyframes targetExpand { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.8); opacity: 0; } }
  @keyframes hitBurst { 0% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(3); opacity: 0; } }
  @keyframes scoreFloat { 0% { transform: translate(-50%, -50%) translateY(0); opacity: 1; } 100% { transform: translate(-50%, -50%) translateY(-60px); opacity: 0; } }
  @keyframes flickFade { 0% { opacity: 1; } 100% { opacity: 0; } }
  @keyframes crosshairFire { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }
  @keyframes strobeBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  @keyframes countPop { 0% { transform: scale(0.5); opacity: 0; } 60% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

  @media (max-width: 600px) {
    .hud-center { gap: 1rem; }
    .hud-stat-value { font-size: 1rem; }
    .bottom-bar { flex-wrap: wrap; gap: 0.5rem; }
    .progress-section { display: none; }
    .hud-logo { display: none; }
    .input-indicator { display: none; }
    .mode-badge { display: none; }
  }
</style>
</head>
<body>

<div class="game-wrapper">
  <div class="hud">
    <div class="hud-left">
      <a href="/dashboard" class="back-btn">
        <svg viewBox="0 0 12 12" width="10" height="10"><path d="M8 1L3 6l5 5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        HUB
      </a>
      <div class="hud-logo">BOS<span> ESPORTS</span></div>
      <div class="hud-rank" id="tierDisplay">BRONZE</div>
    </div>
    <div class="hud-center">
      <div class="hud-stat"><div class="hud-stat-value score-val" id="scoreDisplay">0</div><div class="hud-stat-label">Score</div></div>
      <div class="hud-stat"><div class="hud-stat-value streak-val" id="streakDisplay">0</div><div class="hud-stat-label">Streak</div></div>
      <div class="hud-stat"><div class="hud-stat-value miss-val" id="missDisplay">0</div><div class="hud-stat-label">Missed</div></div>
      <div class="hud-stat"><div class="hud-stat-value time-val" id="timeDisplay">45</div><div class="hud-stat-label">Time</div></div>
    </div>
    <div class="hud-right">
      <div class="input-indicator mouse-active" id="inputIndicator">
        <span class="input-icon" id="inputIcon">üñ±Ô∏è</span>
        <span id="inputLabel">MOUSE</span>
      </div>
      <div class="mode-badge" id="modeBadge">STATIC</div>
    </div>
  </div>

  <div class="play-area" id="playArea">
    <div class="grid-overlay"></div>
    <div class="origin-marker" id="originMarker">
      <div class="origin-ring"></div>
    </div>

    <!-- Gamepad crosshair -->
    <div class="gamepad-crosshair" id="gpCrosshair">
      <div class="crosshair-outer">
        <div class="crosshair-v-top"></div>
        <div class="crosshair-v-bottom"></div>
        <div class="crosshair-dot"></div>
      </div>
      <div class="crosshair-flash" id="crosshairFlash"></div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="flick-indicator">
      <div class="flick-dot"></div>
      <span class="flick-text" id="flickLabel">FlickShot Ready</span>
    </div>
    <div class="progress-section">
      <span class="progress-label">Round</span>
      <div class="progress-track"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
    </div>
    <div class="accuracy-display" id="accuracyDisplay">ACC 100%</div>
  </div>

  <!-- START SCREEN -->
  <div class="screen-overlay" id="startScreen">
    <div class="start-icon">üéØ</div>
    <h1 class="start-title">Flick<span class="glow">Shot</span></h1>
    <p class="start-desc">
      Targets appear at random positions. Flick to them and fire as fast as possible.
      Scores reward speed, accuracy, and flick distance.
      Higher tiers add moving targets, shrinking targets, and precision bonuses.
    </p>
    <div class="input-hint" id="inputHints">
      <div class="input-hint-item active"><span class="icon">üñ±Ô∏è</span> Mouse + Click</div>
      <div class="input-hint-item" id="gpHint"><span class="icon">üéÆ</span> Controller ‚Äî Connect to activate</div>
    </div>
    <div class="tier-select" id="tierSelect">
      <button class="tier-btn active" data-tier="1">Bronze</button>
      <button class="tier-btn" data-tier="2">Silver</button>
      <button class="tier-btn" data-tier="3">Gold</button>
      <button class="tier-btn" data-tier="4">Diamond</button>
      <button class="tier-btn" data-tier="5">Radiant</button>
    </div>
    <button class="start-btn" id="startBtn">Start Match</button>
    <div class="gp-hints" id="gpStartHints">
      <span class="gp-hint-key">A</span> Start &nbsp; <span class="gp-hint-key">D-Pad</span> Select Rank
    </div>
    <a href="/dashboard" class="btn-back-home">
      <svg viewBox="0 0 12 12" width="10" height="10"><path d="M8 1L3 6l5 5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Back to Dashboard
    </a>
  </div>

  <!-- COUNTDOWN -->
  <div class="screen-overlay hidden" id="countdownScreen">
    <div class="countdown-num" id="countdownNumber">3</div>
    <div class="countdown-sub">Lock In ‚Äî Flick Fast</div>
  </div>

  <!-- RESULTS -->
  <div class="screen-overlay hidden" id="resultsScreen">
    <div class="result-rank" id="resultRankLabel">RADIANT</div>
    <div class="result-grade" id="resultGrade">S</div>
    <div class="result-msg" id="resultMsg">Elite precision</div>
    <div class="result-input-tag" id="resultInputTag">Played with: Mouse</div>
    <div class="results-grid">
      <div class="result-cell"><div class="result-value gold" id="resultScore">0</div><div class="result-label">Final Score</div></div>
      <div class="result-cell"><div class="result-value neon" id="resultAccuracy">0%</div><div class="result-label">Accuracy</div></div>
      <div class="result-cell"><div class="result-value electric" id="resultStreak">0</div><div class="result-label">Best Streak</div></div>
      <div class="result-cell"><div class="result-value gold" id="resultHits">0</div><div class="result-label">Eliminations</div></div>
      <div class="result-cell"><div class="result-value neon" id="resultReaction">0ms</div><div class="result-label">Avg Flick Time</div></div>
      <div class="result-cell"><div class="result-value electric" id="resultTier">BRZ</div><div class="result-label">Rank</div></div>
    </div>
    <div class="btn-group">
      <button class="start-btn" id="rematchBtn">Rematch</button>
      <button class="btn-secondary" id="menuBtn">Menu</button>
      <a href="/dashboard" class="btn-secondary">‚Üê Dashboard</a>
    </div>
    <div class="gp-hints" id="gpResultHints">
      <span class="gp-hint-key">A</span> Rematch &nbsp; <span class="gp-hint-key">B</span> Menu
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const state = {
  tier: 1, score: 0, streak: 0, bestStreak: 0,
  hits: 0, misses: 0, timeLeft: 45, running: false,
  reactionTimes: [], screen: 'start', inputMode: 'mouse',
  lastClickX: 0, lastClickY: 0, activeTarget: null,
  totalFlickDist: 0,
};

const TIERS = {
  1: { targetLife: 2500, size: 56, minSize: 56, spawnRate: 1800, moving: false, shrinking: false, precision: false, name: 'BRONZE', short: 'BRZ', modeLabel: 'STATIC' },
  2: { targetLife: 2200, size: 52, minSize: 52, spawnRate: 1500, moving: false, shrinking: true, precision: false, name: 'SILVER', short: 'SLV', modeLabel: 'SHRINK' },
  3: { targetLife: 2000, size: 50, minSize: 28, spawnRate: 1300, moving: true, shrinking: false, precision: true, name: 'GOLD', short: 'GLD', modeLabel: 'MOVING' },
  4: { targetLife: 1700, size: 48, minSize: 22, spawnRate: 1100, moving: true, shrinking: true, precision: true, name: 'DIAMOND', short: 'DIA', modeLabel: 'MIX' },
  5: { targetLife: 1400, size: 44, minSize: 18, spawnRate: 900, moving: true, shrinking: true, precision: true, name: 'RADIANT', short: 'RAD', modeLabel: 'CHAOS' },
};

let config, gameTimer, spawnTimer, moveTimer;
const $ = id => document.getElementById(id);
const playArea = $('playArea');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAMEPAD SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const gp = {
  connected: false, index: null,
  crossX: 0, crossY: 0,
  sensitivity: 8, deadzone: 0.15,
  prevButtons: {}, fireHeld: false,
};

window.addEventListener('gamepadconnected', (e) => {
  gp.connected = true; gp.index = e.gamepad.index;
  setInputMode('controller');
  const area = playArea.getBoundingClientRect();
  gp.crossX = area.width / 2; gp.crossY = area.height / 2;
  updateCrosshairPosition();
});

window.addEventListener('gamepaddisconnected', () => {
  gp.connected = false; gp.index = null;
  setInputMode('mouse');
});

function setInputMode(mode) {
  state.inputMode = mode;
  const ind = $('inputIndicator'), ch = $('gpCrosshair');
  if (mode === 'controller') {
    ind.className = 'input-indicator controller-active';
    $('inputIcon').textContent = 'üéÆ'; $('inputLabel').textContent = 'CONTROLLER';
    ch.classList.add('visible'); playArea.classList.add('controller-mode');
    $('gpHint').innerHTML = '<span class="icon">üéÆ</span> Controller Connected ‚úì';
    $('gpHint').classList.add('active');
    document.querySelectorAll('.gp-hints').forEach(h => h.classList.add('visible'));
  } else {
    ind.className = 'input-indicator mouse-active';
    $('inputIcon').textContent = 'üñ±Ô∏è'; $('inputLabel').textContent = 'MOUSE';
    ch.classList.remove('visible'); playArea.classList.remove('controller-mode');
    document.querySelectorAll('.gp-hints').forEach(h => h.classList.remove('visible'));
  }
}

function updateCrosshairPosition() {
  $('gpCrosshair').style.left = gp.crossX + 'px';
  $('gpCrosshair').style.top = gp.crossY + 'px';
}

function getCrosshairTarget() {
  const t = state.activeTarget;
  if (!t || !t.el || !t.el.parentNode) return null;
  const r = t.el.getBoundingClientRect(), pr = playArea.getBoundingClientRect();
  const tx = r.left - pr.left, ty = r.top - pr.top;
  const pad = 10;
  if (gp.crossX >= tx - pad && gp.crossX <= tx + r.width + pad && gp.crossY >= ty - pad && gp.crossY <= ty + r.height + pad) return t;
  return null;
}

function fireCrosshair() {
  const f = $('crosshairFlash'); f.classList.remove('firing'); void f.offsetWidth; f.classList.add('firing');
}

function buttonPressed(gpad, idx) {
  const p = gpad.buttons[idx] && gpad.buttons[idx].pressed;
  const was = gp.prevButtons[idx] || false;
  gp.prevButtons[idx] = p;
  return p && !was;
}

function gamepadLoop() {
  if (!gp.connected) { requestAnimationFrame(gamepadLoop); return; }
  const gpads = navigator.getGamepads();
  const gpad = gpads[gp.index];
  if (!gpad) { requestAnimationFrame(gamepadLoop); return; }

  const hasInput = gpad.axes.some(a => Math.abs(a) > gp.deadzone) || gpad.buttons.some(b => b.pressed);
  if (hasInput && state.inputMode !== 'controller') {
    setInputMode('controller');
    const area = playArea.getBoundingClientRect();
    gp.crossX = area.width / 2; gp.crossY = area.height / 2;
  }

  if (state.screen === 'start') {
    if (buttonPressed(gpad, 14)) { state.tier = Math.max(1, state.tier - 1); selectTierUI(state.tier); }
    if (buttonPressed(gpad, 15)) { state.tier = Math.min(5, state.tier + 1); selectTierUI(state.tier); }
    if (buttonPressed(gpad, 0)) startCountdown();
  }

  if (state.screen === 'playing') {
    const lx = gpad.axes[0], ly = gpad.axes[1];
    const area = playArea.getBoundingClientRect();
    if (Math.abs(lx) > gp.deadzone) gp.crossX += lx * gp.sensitivity;
    if (Math.abs(ly) > gp.deadzone) gp.crossY += ly * gp.sensitivity;
    gp.crossX = Math.max(0, Math.min(area.width, gp.crossX));
    gp.crossY = Math.max(0, Math.min(area.height, gp.crossY));
    updateCrosshairPosition();

    const over = getCrosshairTarget();
    $('gpCrosshair').classList.toggle('on-target', !!over);

    const r2 = gpad.buttons[7] ? gpad.buttons[7].value : 0;
    const fire = buttonPressed(gpad, 7) || buttonPressed(gpad, 0) || (r2 > 0.5 && !gp.fireHeld);
    gp.fireHeld = r2 > 0.5;

    if (fire && state.running) {
      fireCrosshair();
      if (over) {
        handleHit(over, gp.crossX, gp.crossY);
      } else {
        handleMiss(gp.crossX, gp.crossY);
      }
    }
  }

  if (state.screen === 'results') {
    if (buttonPressed(gpad, 0)) restartGame();
    if (buttonPressed(gpad, 1)) backToMenu();
  }

  requestAnimationFrame(gamepadLoop);
}
requestAnimationFrame(gamepadLoop);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TIER SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectTierUI(t) {
  state.tier = t;
  document.querySelectorAll('.tier-btn').forEach(b => b.classList.toggle('active', parseInt(b.dataset.tier) === t));
}

$('tierSelect').addEventListener('click', (e) => {
  const btn = e.target.closest('.tier-btn');
  if (btn) selectTierUI(parseInt(btn.dataset.tier));
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME FLOW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
$('startBtn').addEventListener('click', startCountdown);
$('rematchBtn').addEventListener('click', restartGame);
$('menuBtn').addEventListener('click', backToMenu);

function startCountdown() {
  state.screen = 'countdown';
  $('startScreen').classList.add('hidden');
  $('countdownScreen').classList.remove('hidden');
  let count = 3;
  $('countdownNumber').textContent = count;
  const iv = setInterval(() => {
    count--;
    if (count > 0) {
      $('countdownNumber').textContent = count;
      $('countdownNumber').style.animation = 'none';
      void $('countdownNumber').offsetWidth;
      $('countdownNumber').style.animation = 'countPop 0.5s ease-out';
    } else { clearInterval(iv); $('countdownScreen').classList.add('hidden'); startGame(); }
  }, 800);
}

function startGame() {
  state.screen = 'playing';
  config = TIERS[state.tier];
  Object.assign(state, { score: 0, streak: 0, bestStreak: 0, hits: 0, misses: 0, timeLeft: 45, running: true, reactionTimes: [], activeTarget: null, totalFlickDist: 0 });
  $('tierDisplay').textContent = config.name;
  $('modeBadge').textContent = config.modeLabel;

  // Init last click to center
  const area = playArea.getBoundingClientRect();
  state.lastClickX = area.width / 2;
  state.lastClickY = area.height / 2;

  if (gp.connected) {
    gp.crossX = area.width / 2; gp.crossY = area.height / 2;
    updateCrosshairPosition();
  }

  updateHUD();

  gameTimer = setInterval(() => {
    state.timeLeft--;
    $('timeDisplay').textContent = state.timeLeft;
    $('progressFill').style.width = ((45 - state.timeLeft) / 45 * 100) + '%';
    if (state.timeLeft <= 0) endGame();
  }, 1000);

  spawnTarget();
  spawnTimer = setInterval(() => {
    if (!state.running) return;
    if (!state.activeTarget || !state.activeTarget.el.parentNode) spawnTarget();
  }, config.spawnRate);

  // Moving targets update
  if (config.moving) {
    moveTimer = setInterval(() => {
      if (!state.running || !state.activeTarget || !state.activeTarget.moving) return;
      const t = state.activeTarget;
      t.x += t.vx; t.y += t.vy;
      const area = playArea.getBoundingClientRect();
      if (t.x < 20 || t.x > area.width - 60) t.vx *= -1;
      if (t.y < 20 || t.y > area.height - 60) t.vy *= -1;
      t.el.style.left = t.x + 'px'; t.el.style.top = t.y + 'px';
    }, 16);
  }

  playArea.addEventListener('click', onPlayAreaClick);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TARGETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnTarget() {
  if (!state.running) return;

  // Remove existing
  if (state.activeTarget && state.activeTarget.el.parentNode) state.activeTarget.el.remove();

  const area = playArea.getBoundingClientRect();
  const m = 50;
  const isPrecision = config.precision && Math.random() < 0.2;
  const isMoving = config.moving && !isPrecision && Math.random() < 0.5;
  const isShrinking = config.shrinking && !isPrecision && Math.random() < 0.5;

  let size = isPrecision ? 26 : config.size;
  const x = m + Math.random() * (area.width - size - m * 2);
  const y = m + Math.random() * (area.height - size - m * 2);

  const el = document.createElement('div');
  el.className = `flick-target ${isPrecision ? 'precision' : ''} ${isMoving ? 'moving' : ''} ${isShrinking ? 'shrinking' : ''}`;
  el.style.left = x + 'px'; el.style.top = y + 'px';
  el.style.width = size + 'px'; el.style.height = size + 'px';
  el.innerHTML = '<div class="flick-target-ring"><div class="flick-target-dot"></div></div>';

  el.addEventListener('click', (e) => {
    e.stopPropagation();
    const r = el.getBoundingClientRect(), pr = playArea.getBoundingClientRect();
    handleHit(state.activeTarget, r.left - pr.left + r.width / 2, r.top - pr.top + r.height / 2);
  });

  playArea.appendChild(el);

  const target = {
    el, x, y, size, isPrecision, isMoving, isShrinking,
    moving: isMoving,
    vx: isMoving ? (Math.random() - 0.5) * 3 : 0,
    vy: isMoving ? (Math.random() - 0.5) * 3 : 0,
    spawn: Date.now(),
    shrinkTimer: null,
  };

  state.activeTarget = target;

  // Show origin marker at last click position
  const om = $('originMarker');
  om.style.left = (state.lastClickX - 12) + 'px';
  om.style.top = (state.lastClickY - 12) + 'px';
  om.classList.add('visible');

  // Shrinking
  if (isShrinking) {
    const startSize = config.size;
    const endSize = config.minSize;
    const duration = config.targetLife;
    const startTime = Date.now();

    target.shrinkTimer = setInterval(() => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const currentSize = startSize - (startSize - endSize) * progress;
      el.style.width = currentSize + 'px';
      el.style.height = currentSize + 'px';
      target.size = currentSize;
      if (progress >= 1) clearInterval(target.shrinkTimer);
    }, 30);
  }

  // Auto-expire
  setTimeout(() => {
    if (!el.parentNode) return;
    if (target.shrinkTimer) clearInterval(target.shrinkTimer);
    state.misses++; state.streak = 0;
    updateHUD();
    el.remove();
    if (state.running) spawnTarget();
  }, config.targetLife);
}

function handleHit(target, cx, cy) {
  if (!state.running || !target || !target.el.parentNode) return;

  const reaction = Date.now() - target.spawn;
  state.reactionTimes.push(reaction);

  // Calculate flick distance
  const dx = cx - state.lastClickX;
  const dy = cy - state.lastClickY;
  const flickDist = Math.sqrt(dx * dx + dy * dy);
  state.totalFlickDist += flickDist;

  // Draw flick line
  drawFlickLine(state.lastClickX, state.lastClickY, cx, cy);

  // Score calculation
  let base = 100;
  if (target.isPrecision) base = 250; // Precision bonus
  if (target.isMoving) base += 50; // Moving bonus

  // Speed bonus
  const speedBonus = reaction < 400 ? 75 : reaction < 600 ? 50 : reaction < 800 ? 25 : 0;

  // Distance bonus ‚Äî longer flicks = more points
  const distBonus = Math.floor(flickDist / 50) * 10;

  // Streak bonus
  const streakBonus = Math.floor(state.streak / 3) * 25;

  const pts = base + speedBonus + distBonus + streakBonus;
  state.score += pts;
  state.hits++;
  state.streak++;
  state.bestStreak = Math.max(state.bestStreak, state.streak);

  // FX
  const hitEl = document.createElement('div');
  hitEl.className = 'hit-effect';
  hitEl.style.left = cx + 'px'; hitEl.style.top = cy + 'px';
  hitEl.style.width = target.size + 'px'; hitEl.style.height = target.size + 'px';
  playArea.appendChild(hitEl); setTimeout(() => hitEl.remove(), 500);

  const scoreEl = document.createElement('div');
  scoreEl.className = `hit-score ${target.isPrecision ? 'precision-hit' : ''}`;
  scoreEl.textContent = '+' + pts;
  scoreEl.style.left = cx + 'px'; scoreEl.style.top = (cy - 20) + 'px';
  playArea.appendChild(scoreEl); setTimeout(() => scoreEl.remove(), 800);

  // Show distance bonus tag
  if (distBonus > 0) {
    const distEl = document.createElement('div');
    distEl.className = 'distance-tag';
    distEl.textContent = `FLICK +${distBonus}`;
    distEl.style.left = cx + 'px'; distEl.style.top = (cy + 20) + 'px';
    playArea.appendChild(distEl); setTimeout(() => distEl.remove(), 1000);
  }

  // Update last click position
  state.lastClickX = cx;
  state.lastClickY = cy;

  if (target.shrinkTimer) clearInterval(target.shrinkTimer);
  target.el.remove();
  state.activeTarget = null;
  updateHUD();

  // Spawn next immediately
  setTimeout(() => { if (state.running) spawnTarget(); }, 200);
}

function handleMiss(cx, cy) {
  if (!state.running) return;
  state.misses++; state.streak = 0;
  state.lastClickX = cx; state.lastClickY = cy;

  const missEl = document.createElement('div');
  missEl.className = 'hit-score miss-hit';
  missEl.textContent = 'MISS';
  missEl.style.left = cx + 'px'; missEl.style.top = cy + 'px';
  playArea.appendChild(missEl); setTimeout(() => missEl.remove(), 600);

  updateHUD();
}

function onPlayAreaClick(e) {
  if (!state.running || e.target.closest('.flick-target')) return;
  const pr = playArea.getBoundingClientRect();
  handleMiss(e.clientX - pr.left, e.clientY - pr.top);
}

function drawFlickLine(x1, y1, x2, y2) {
  const dx = x2 - x1, dy = y2 - y1;
  const dist = Math.sqrt(dx * dx + dy * dy);
  const angle = Math.atan2(dy, dx) * (180 / Math.PI);

  const line = document.createElement('div');
  line.className = 'flick-line';
  line.style.left = x1 + 'px'; line.style.top = y1 + 'px';
  line.style.width = dist + 'px';
  line.style.transform = `rotate(${angle}deg)`;
  playArea.appendChild(line);
  setTimeout(() => line.remove(), 500);
}

function updateHUD() {
  $('scoreDisplay').textContent = state.score;
  $('streakDisplay').textContent = state.streak;
  $('missDisplay').textContent = state.misses;
  const t = state.hits + state.misses;
  $('accuracyDisplay').textContent = `ACC ${t > 0 ? Math.round((state.hits / t) * 100) : 100}%`;
}

function endGame() {
  state.screen = 'results';
  state.running = false;
  clearInterval(gameTimer); clearInterval(spawnTimer); clearInterval(moveTimer);
  playArea.removeEventListener('click', onPlayAreaClick);
  if (state.activeTarget) {
    if (state.activeTarget.shrinkTimer) clearInterval(state.activeTarget.shrinkTimer);
    if (state.activeTarget.el.parentNode) state.activeTarget.el.remove();
  }
  $('originMarker').classList.remove('visible');

  const total = state.hits + state.misses;
  const acc = total > 0 ? Math.round((state.hits / total) * 100) : 0;
  const avgR = state.reactionTimes.length > 0 ? Math.round(state.reactionTimes.reduce((a, b) => a + b, 0) / state.reactionTimes.length) : 0;

  let grade, gc, msg, rankLabel, rankColor;
  if (state.score >= 3500 && acc >= 85) { grade = 'S'; gc = 's-rank'; msg = 'Radiant-level flick precision'; rankLabel = 'RADIANT'; rankColor = 'var(--gold)'; }
  else if (state.score >= 2200 && acc >= 75) { grade = 'A'; gc = 'a-rank'; msg = 'Diamond-tier target acquisition'; rankLabel = 'DIAMOND'; rankColor = 'var(--neon)'; }
  else if (state.score >= 1300 && acc >= 60) { grade = 'B'; gc = 'b-rank'; msg = 'Gold-level flick speed'; rankLabel = 'GOLD'; rankColor = 'var(--electric)'; }
  else { grade = 'C'; gc = 'c-rank'; msg = 'Keep grinding ‚Äî precision improving'; rankLabel = 'SILVER'; rankColor = 'var(--text-mid)'; }

  $('resultRankLabel').textContent = rankLabel;
  $('resultRankLabel').style.color = rankColor;
  $('resultGrade').textContent = grade;
  $('resultGrade').className = `result-grade ${gc}`;
  $('resultMsg').textContent = msg;
  $('resultInputTag').textContent = `Played with: ${gp.connected ? 'Controller üéÆ' : 'Mouse üñ±Ô∏è'}`;
  $('resultScore').textContent = state.score;
  $('resultAccuracy').textContent = acc + '%';
  $('resultStreak').textContent = state.bestStreak;
  $('resultHits').textContent = state.hits;
  $('resultReaction').textContent = avgR + 'ms';
  $('resultTier').textContent = config.short;
  $('resultsScreen').classList.remove('hidden');

  // ‚îÄ‚îÄ‚îÄ SAVE SCORE TO SERVER ‚îÄ‚îÄ‚îÄ
  try {
    fetch('/api/scores', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        game: 'flickshot',
        tier: state.tier,
        score: state.score,
        accuracy: acc,
        bestStreak: state.bestStreak,
        avgReaction: avgR,
        hits: state.hits,
        misses: state.misses,
        inputMode: gp.connected ? 'controller' : 'mouse',
        grade: grade
      })
    }).then(function() {}).catch(function() {});
  } catch (ignore) {}
}

function restartGame() {
  // Clean up any leftover DOM elements
  document.querySelectorAll('.flick-target, .flick-line, .hit-effect, .hit-score, .distance-tag').forEach(function(el) { el.remove(); });
  $('originMarker').classList.remove('visible');
  $('resultsScreen').classList.add('hidden');
  startCountdown();
}

function backToMenu() {
  state.screen = 'start';
  document.querySelectorAll('.flick-target, .flick-line, .hit-effect, .hit-score, .distance-tag').forEach(function(el) { el.remove(); });
  $('originMarker').classList.remove('visible');
  $('resultsScreen').classList.add('hidden');
  $('startScreen').classList.remove('hidden');
}
</script>

</body>
</html>
